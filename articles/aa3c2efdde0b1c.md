---
title: "ãƒŸãƒªã—ã‚‰Kubernetesã€œãƒ‰åˆå¿ƒè€…ãŒKubernetesã‚’ã‚ã‚‹ç¨‹åº¦ç†è§£ã™ã‚‹ã¾ã§ã®è¨˜éŒ²ã€œ"
emoji: "ğŸ•¸ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Kubernetes, Docker]
published: true
published_at: 2027-05-31 09:00
---

## ğŸ¯ ã¯ã˜ã‚ã«

ç­†è€…ã¯Dockerã‚’æ¥­å‹™ã§è§¦ã£ãŸã“ã¨ã¯ã”ã–ã„ã¾ã™ãŒã€Kubernetesã‚’æ¥­å‹™ã§è§¦ã£ãŸã“ã¨ãŒã”ã–ã„ã¾ã›ã‚“ã€‚  
ãã“ã§ã€  
**Kubernetesã‚’1ãƒŸãƒªã‚‚ã—ã‚‰ãªã„çŠ¶æ…‹ã§ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã—ã¦ã„ã‘ã°ã©ã“ã¾ã§ç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã‹**  
ã‚’ãƒãƒ³ã‚ºã‚ªãƒ³å½¢å¼ã§å®Ÿè·µã—ã¦ç†è§£ã‚’æ·±ã‚ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## ğŸ› ï¸ ç’°å¢ƒæ§‹ç¯‰

### Docker

Dockerã¯ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚  
ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰è‡ªåˆ†ã®ç’°å¢ƒã«åˆã‚ã›ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
<https://docs.docker.com/engine/install/>

---

### IDEï¼ˆé–‹ç™ºç’°å¢ƒï¼‰

Visual Studio Codeãªã©æ…£ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã„ã„ã¨ã¯æ€ã„ã¾ã™ãŒã€ç§ã¯Cursorã‚’ä½¿ç”¨ã—ã¦ã„ãã¾ã™ã€‚  
<https://www.cursor.com/ja>

ã¾ãŸã€ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«ã¯æ‹¡å¼µæ©Ÿèƒ½ã€Œ**Remote SSH**ã€ãŒå¿…è¦ã§ã™ã®ã§ãã¡ã‚‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚  
<https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-ssh>

---

### Kubernetes CLIï¼ˆkubectlï¼‰

ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚

```bash:terminal
brew install kubernetes-cli
```

```bash:terminal
brew install minikube
```

(å‚è€ƒ)  
<https://qiita.com/Asaminnn/items/6d414d4776d964e94e96>

## ğŸ“š Kubernetesã®åŸºç¤çŸ¥è­˜

### Kubernetesã¨ã¯

ã€Œ**Kubernetes**ã€ã¨ã¯ã€  
**ã‚³ãƒ³ãƒ†ãƒŠå‹ä»®æƒ³åŒ–æŠ€è¡“ã‚’å¯¾è±¡ã¨ã—ãŸé‹ç”¨ç®¡ç†ã€è‡ªå‹•åŒ–ã®ãƒ„ãƒ¼ãƒ«ã€ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã®ä¸€ã¤**  
ã®ã“ã¨ã§ã™ã€‚

---

### Dockerã¨Kubernetesã®é•ã„

ã‚³ãƒ³ãƒ†ãƒŠã¨èãã¨Dockerã‚’æ€ã„æµ®ã‹ã¹ã¾ã™ãŒã€Dockerã¨Kubernetesã§ã¯é•ã„ãŒã‚ã‚Šã¾ã™ã€‚

**Docker**ã¯ç°¡å˜ã«ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆã‚„å‰Šé™¤ãŒã§ãã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚  
å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚³ãƒ¼ãƒ‰åŒ–ã‚„ç’°å¢ƒã®å†é…å¸ƒã€ãƒãƒ¼ãƒ é–‹ç™ºæ™‚ã®ç’°å¢ƒã®çµ±ä¸€ãªã©ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ä¸€æ–¹ã€**Kubernetes**ã¯è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”¨ã„ãŸé–‹ç™ºã«ä½¿ç”¨ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚  
å„ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã€å•é¡Œã®ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã™ã‚‹ã€ã¨ã„ã£ãŸç®¡ç†ãŒå¯èƒ½ã§ã™ã€‚

#### ç®¡ç†å˜ä½ã®é•ã„

ã“ã®äºŒã¤ã®ãƒ„ãƒ¼ãƒ«ã®é–“ã§ã¯ç®¡ç†å˜ä½ã«ã‚‚é•ã„ãŒã‚ã‚Šã¾ã™ã€‚

**Docker**ã¯ã‚ã‚‹**ãƒã‚·ãƒ³ä¸Šã®ä¸€ã¤ä¸€ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠãŒæœ€å°ã®å˜ä½**ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã®ä¹—ã£ãŸãƒã‚·ãƒ³ã§ã‚ã‚‹ãƒãƒ¼ãƒ‰ã‚‚ç®¡ç†ã®å˜ä½ã§ã™ã€‚

ä¸€æ–¹ã®**Kubernetes**ã§ã¯æœ€å°ã®å˜ä½ã¯**Pod**ã§ã™ã€‚  
Podã¯ä¸€ã¤ä»¥ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã‚’æŒã¡ã¾ã™ãŒã€1Podã«1ã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚‹å ´åˆãŒå¤šã„ã§ã™ã€‚  
**1ã¤ä»¥ä¸Šã®Podã‚’æŒã¤ãƒã‚·ãƒ³ãŒãƒãƒ¼ãƒ‰ï¼ˆãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ï¼‰** ã§ã™ã€‚

ã‚ˆã‚Šå¤§ãã„å˜ä½ã¨ã—ã¦ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚  
**ã‚¯ãƒ©ã‚¹ã‚¿ã¯ãƒãƒ¼ãƒ‰ã®é›†åˆä½“**ã§ã€1ã¤ä»¥ä¸Šã®ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã¨ãã‚Œã‚’ç®¡ç†ã™ã‚‹ãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ã‚’æŒã¡ã¾ã™ã€‚

|          | Kubernetes            | Docker                       |
| -------- | --------------------- | ---------------------------- |
| **ç”¨é€”** | ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†          | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠåŒ– |
| **å˜ä½** | Podã€ãƒãƒ¼ãƒ‰ã€ã‚¯ãƒ©ã‚¹ã‚¿ | ã‚³ãƒ³ãƒ†ãƒŠã€ãƒãƒ¼ãƒ‰             |

---

### Kubernetesã®ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

Kubernetesã¯ã€éå¸¸ã«åŠ¹ç‡ã‚ˆãå¤§è¦æ¨¡ãªITã‚¤ãƒ³ãƒ•ãƒ©ã‚’é‹ç”¨ãƒ»ç®¡ç†ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚  
ã—ã‹ã—ã€ä¸‡èƒ½ã®ãƒ„ãƒ¼ãƒ«ã¨ã„ã†ã‚ã‘ã§ã¯ãªãã€å®Ÿéš›ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’æŒã¡ã¾ã™ã€‚

#### âœ… ãƒ¡ãƒªãƒƒãƒˆ

- **ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã§ãã‚‹**  
  Kubernetesã«ã¯ã€è² è·åˆ†æ•£ã‚„ãƒªã‚½ãƒ¼ã‚¹é…åˆ†ãªã©ã‚’è‡ªå‹•çš„ã«èª¿æ•´ã™ã‚‹æ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

  ã“ã†ã—ãŸæ©Ÿèƒ½ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šç¨¼åƒã«ãŠã„ã¦éå¸¸ã«é‡è¦ãªã€Œèª¿æ•´ä½œæ¥­ã€ã‚’è‡ªå‹•åŒ–ã§ãã‚‹ãŸã‚ã€é‹ç”¨ã‚³ã‚¹ãƒˆã®ä½æ¸›ãŒå¯èƒ½ã§ã™ã€‚

  ã¾ãŸã€éå»ã®å®Ÿç¸¾ã«åŸºã¥ã„ã¦åŠ¹ç‡ã‚ˆããƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã§ãã‚‹ãŸã‚ã€å¾“é‡èª²é‡‘åˆ¶ã‚’æ¡ç”¨ã™ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®æœˆé¡åˆ©ç”¨æ–™ã‚’ç¯€ç´„ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- **å¤§é‡ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¸€æ‹¬ç®¡ç†ã§ãã‚‹**  
  Kubernetesã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€å¤§é‡ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®¹æ˜“ã«ç®¡ç†ã§ãã¾ã™ã€‚

  ä¾‹ãˆã°ã€å¤šãã®ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦è¨­å®šã‚’å¤‰æ›´ã™ã‚‹éš›ã«ã€ã‚³ãƒ³ãƒ†ãƒŠ1ã¤1ã¤ã«å¤‰æ›´ä½œæ¥­ã‚’è¡Œã†ã®ã¯å¤§å¤‰ãªåŠ´åŠ›ãŒã‹ã‹ã‚Šã¾ã™ã€‚

  Kubernetesã§ã¯ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠé–“ã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ã§ãã‚‹ãŸã‚ã€ã“ã®ã‚ˆã†ãªè¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã™ã‚‹è¨­å®šå¤‰æ›´ã‚‚å€‹åˆ¥ã«è¡Œã†å¿…è¦ãŒç„¡ããªã‚Šã¾ã™ã€‚

  ã¾ãŸã€ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«å¯¾å¿œã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ã‚’æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒãªã„ã¨ã„ã†ç‚¹ã‚‚å¤§ããªãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚

- **èµ·å‹•ãŒé«˜é€Ÿãƒ»è»½é‡ã§è¿…é€Ÿãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’å®Ÿç¾ã§ãã‚‹**  
  ã‚³ãƒ³ãƒ†ãƒŠã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã¨ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒªã‚½ãƒ¼ã‚¹æ¶ˆè²»ã‚’æŠ‘ãˆã€å¾“æ¥ã®ä»®æƒ³ãƒã‚·ãƒ³ã‚ˆã‚Šã‚‚é«˜é€Ÿã‹ã¤è»½é‡ã§å‹•ä½œã—ã¾ã™ã€‚

  ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªã‚½ãƒ¼ã‚¹ã‚’åŠ¹ç‡çš„ã«æ´»ç”¨ã§ãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚’è¿…é€Ÿã«é€²ã‚ã‚‰ã‚Œã¾ã™ã€‚

  å¸‚å ´ã®å¤‰åŒ–ã«å¯¾å¿œã—è¿…é€Ÿãªãƒªãƒªãƒ¼ã‚¹ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹æ˜¨ä»Šã§ã¯ã€Kubernetesã®æ´»ç”¨ã¯éå¸¸ã«é‡è¦ã§ã™ã€‚

- **DevOpsã‚’å®Ÿç¾ã—ã‚„ã™ã„**  
  DevOpsã¨ã¯ã€Œé–‹ç™ºã¨é‹ç”¨ã®ä¸€ä½“åŒ–ã«ã‚ˆã£ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’å¸¸ã«æœ€æ–°ã®çŠ¶æ…‹ã«ä¿ã¡ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã„ã¡æ—©ãæ–°ã—ã„ä¾¡å€¤ã‚’å±Šã‘ã‚‹ã€ã¨ã„ã†è€ƒãˆæ–¹ã§ã™ã€‚

  ç‰¹ã«Webã‚µãƒ¼ãƒ“ã‚¹ãªã©ã®ç¶™ç¶šçš„ãªæ©Ÿèƒ½ã®æ›´æ–°ã¨ãƒªãƒªãƒ¼ã‚¹ã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã§å–ã‚Šå…¥ã‚Œã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

  Kubernetesã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºãƒ»é‹ç”¨ã«å¿…è¦ãªæ©Ÿèƒ½ãŒã»ã¼ç¶²ç¾…ã•ã‚Œã¦ãŠã‚Šã€é–‹ç™ºãƒ»é‹ç”¨ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«é€£çµã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

  æœ¬ç•ªç’°å¢ƒã‚’ç¨¼åƒã•ã›ãŸçŠ¶æ…‹ã§ã€æ”¹å–„ç‚¹ã®å®Ÿè£…ã¨é©ç”¨ãŒè¡Œãˆã‚‹ãŸã‚ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’å¸¸ã«æœ€æ–°ãƒ»æœ€å–„ã®çŠ¶æ…‹ã«ä¿ã¡ã¤ã¤ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’æœ€å°åŒ–ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã¯ã€ŒDevOpsã€ã®å®Ÿç¾ã«ãŠã„ã¦å¨åŠ›ã‚’ç™ºæ®ã—ã¾ã™ã€‚

- **ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã¨ã‚¯ãƒ©ã‚¦ãƒ‰ã®ã©ã¡ã‚‰ã§ã‚‚åˆ©ç”¨ã§ãã‚‹**  
  Kubernetesã¯è¤‡æ•°ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ»ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ä¸Šã§å‹•ä½œã—ã¾ã™ã€‚

  æ›´ã«ã‚¯ãƒ©ã‚¦ãƒ‰ã®ãƒ™ãƒ³ãƒ€ãƒ¼ã®å¤šããŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰å•ã‚ãšã«åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

  ä½¿ç”¨ç”¨é€”ã‚„å‰æã‚’å•ã‚ãšä½¿ç”¨ã§ãã‚‹ãŸã‚ã€è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”¨ã„ãŸé–‹ç™ºã‚’ã™ã‚‹å ´åˆã¯ç©æ¥µçš„ã«ä½¿ç”¨ã—ãŸã„æŠ€è¡“ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚

- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚å®¹æ˜“ã«ãªã‚‹**  
  Kubernetesã§ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚’åŸºã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ãŸã‚ã€æ‰‹å‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

  ã•ã‚‰ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œã™ã‚‹ãŸã‚ã€é€”ä¸­ã§æ­¢ã¾ã£ã¦ã—ã¾ã†ãªã©ã®å¯èƒ½æ€§ãŒä½ã„ã§ã™ã€‚

- **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®æŸ”è»Ÿæ€§ãŒé«˜ã„**  
  Kubernetesã§ã¯Podã‚’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

  ãã®ãŸã‚ã€ä½¿ç”¨ã™ã‚‹ç”¨é€”ã«å¿œã˜ã¦Podã®è‡ªå‹•ç”Ÿæˆãªã©ãŒã§ãã€æŸ”è»Ÿã«ãƒªã‚½ãƒ¼ã‚¹ã‚’å¢—æ¸›ã§ãã¾ã™ã€‚

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã§ãã‚‹**  
  Kubernetesã¯å‘¨è¾ºæŠ€è¡“ã‚’ç†è§£ã§ãã‚‹ã“ã¨ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–ãŒå¯èƒ½ã§ã™ã€‚

  ä¾‹ãˆã°Kubernetesã¯APIã‚’ç”¨ã„ã¦æ“ä½œã™ã‚‹ãŸã‚ã€APIã‚’ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼ãƒ»æ¨©é™ã®åˆ¶é™ã‚’ã™ã‚‹ã“ã¨ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ€§èƒ½ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

  ã¾ãŸã€Podã‚„ã‚³ãƒ³ãƒ†ãƒŠãªã©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã‚‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–ãŒæœŸå¾…ã§ãã¾ã™ã€‚

  ã“ã®ã‚ˆã†ã«æ§˜ã€…ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚„æ©Ÿèƒ½åˆ¶é™ã€æ¨©é™ã®è¨­å®šã‚’ç´°ã‹ãã§ãã‚‹ãŸã‚ã€ä½¿ç”¨ç”¨é€”ã«å¿œã˜ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã§ãã¾ã™ã€‚

- **éšœå®³ã«å¼·ã„**  
  Kubernetesã¯è‡ªå‹•å›å¾©æ©Ÿèƒ½ã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

  ã‚³ãƒ³ãƒ†ãƒŠãŒãƒ€ã‚¦ãƒ³ã—ãŸå ´åˆã‚„èª¤ã£ã¦å‰Šé™¤ã—ã¦ã—ã¾ã£ãŸå ´åˆã«ã‚‚ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’è‡ªå‹•ã§å›å¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

  ã“ã®è‡ªå‹•å›å¾©æ©Ÿèƒ½ã¯ã€å„ç¨®ã®éšœå®³ã«å¯¾ã™ã‚‹å¼·ã•ã¨ãªã‚Šã¾ã™ã€‚

  åˆ©ç”¨è€…ã¯è‡ªå‹•å›å¾©æ©Ÿèƒ½ã‚’é ¼ã‚Šã«ã€è½ã¡ç€ã„ã¦æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### âŒ ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

- **ç‰©ç†ã‚µãƒ¼ãƒãƒ¼ã®å°æ•°ãŒå¢—ãˆã‚‹å‚¾å‘ã«ã‚ã‚ŠåˆæœŸæŠ•è³‡ãŒã‹ã‹ã‚Šã‚„ã™ã„**  
  Kubernetesã§ã¯ã€å®Ÿè¡Œãƒã‚·ãƒ³ã¨ã—ã¦ã®ã€Œãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã€ã¨ç®¡ç†ãƒã‚·ãƒ³ã¨ã—ã¦ã®ã€Œãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ã€ãŒå¿…è¦ã§ã™ã€‚

  å®Ÿéš›ã®é‹ç”¨ã§ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã¨ãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ã‚’åˆ¥ã®ç‰©ç†ãƒã‚·ãƒ³ã¨ã—ã¦ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãƒãƒ¼ãƒ‰ã®æ•°ã«æ¯”ä¾‹ã—ã¦å¿…è¦ã¨ãªã‚‹ç‰©ç†ã‚µãƒ¼ãƒãƒ¼ã®æ•°ã‚‚å¢—åŠ ã—ã¾ã™ã€‚

  ã—ãŸãŒã£ã¦ã€æ§‹æˆã‚„è¦æ¨¡ã«ã‚ˆã£ã¦ã¯ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç’°å¢ƒã®ã‚ˆã†ã«ã‚ã‚‹ç¨‹åº¦ã®åˆæœŸæŠ•è³‡ãŒå¿…è¦ã«ãªã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚

- **æ›´æ–°é »åº¦ãŒé«˜ãã€å­¦ç¿’ã‚³ã‚¹ãƒˆã‚‚é«˜ã„**  
  Kubernetesã¯æ©Ÿèƒ½ãŒè±Šå¯Œã§ã€é€²åŒ–ã®éç¨‹ã«ã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚  
  ã—ãŸãŒã£ã¦ã€Kubernetesã‚’ä¸Šæ‰‹ãæ´»ç”¨ã™ã‚‹ãŸã‚ã«ã¯ç¶™ç¶šçš„ãªã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

- **ä½¿ã„ã“ãªã™ã«ã¯ç›®çš„ã‚’æ˜ç¢ºã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹**  
  Kubernetesã¯è±Šå¯Œãªæ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

  å„æ©Ÿèƒ½ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§æŸ”è»Ÿãªè¨­å®šãŒå®Ÿç¾ã§ãã€æ‹¡å¼µæ€§ã‚‚é«˜ã„ã§ã™ã€‚ãã®åˆ†ã€åˆ©ç”¨æ©Ÿèƒ½ã®é¸æŠã‚„è¨­å®šã«ã‚‚å¤šãã®é¸æŠè‚¢ãŒã‚ã‚Šã¾ã™ã€‚

  Kubernetesã‚’ç”¨ã„ã¦ä½•ã‚’å®Ÿç¾ã—ãŸã„ã®ã‹ã€é‹ç”¨ç®¡ç†ã®å½¢ã‚’äº‹å‰ã«æ˜ç¢ºã«ã—ã¦åˆ©ç”¨ã™ã‚‹æ©Ÿèƒ½ã‚„è¨­å®šå†…å®¹ã‚’å®šã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ğŸ’» ãƒãƒ³ã‚ºã‚ªãƒ³å®Ÿè·µ

### minikubeã®èµ·å‹•

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿæ–½ã—ã€minikubeã‚’èµ·å‹•ã—ã¾ã™:

```bash:terminal
minikube start
```

å®Ÿè¡Œçµæœï¼š

```bash:terminal
W0525 17:12:44.569352   62706 main.go:291] Unable to resolve the current Docker CLI context "default": context "default": context not found: open /Users/wan0ri/.docker/contexts/meta/37a8eec1ce19687d132fe29051dca629d164e2c4958ba141d5f4133a33f0688f/meta.json: no such file or directory
W0525 17:12:44.569404   62706 main.go:292] Try running `docker context use default` to resolve the above error
ğŸ˜„  Darwin 15.5 (arm64) ä¸Šã® minikube v1.36.0
âœ¨  docker ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒè‡ªå‹•çš„ã«é¸æŠã•ã‚Œã¾ã—ãŸ
ğŸ“Œ  root æ¨©é™ã‚’æŒã¤ Docker Desktop ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨
ğŸ‘  Starting "minikube" primary control-plane node in "minikube" cluster
ğŸšœ  Pulling base image v0.0.47 ...
ğŸ’¾  ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ Kubernetes v1.33.1 ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™...
    > preloaded-images-k8s-v18-v1...:  327.15 MiB / 327.15 MiB  100.00% 8.95 Mi
    > gcr.io/k8s-minikube/kicbase...:  463.69 MiB / 463.69 MiB  100.00% 1.79 Mi
ğŸ”¥  Creating docker container (CPUs=2, Memory=7789MB) ...
ğŸ³  Docker 28.1.1 ã§ Kubernetes v1.33.1 ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...
    â–ª è¨¼æ˜æ›¸ã¨éµã‚’ä½œæˆã—ã¦ã„ã¾ã™...
    â–ª ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...
    â–ª RBAC ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šä¸­ã§ã™...
ğŸ”—  bridge CNI (ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹) ã‚’è¨­å®šä¸­ã§ã™...
ğŸ”  Kubernetes ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™...
    â–ª gcr.io/k8s-minikube/storage-provisioner:v5 ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
ğŸŒŸ  æœ‰åŠ¹ãªã‚¢ãƒ‰ã‚ªãƒ³: default-storageclass, storage-provisioner
ğŸ„  çµ‚äº†ã—ã¾ã—ãŸï¼kubectl ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€Œminikubeã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã€Œdefaultã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†è¨­å®šã•ã‚Œã¾ã—ãŸ
```

Docker Desktop ï¼ Container ã‚’ç¢ºèªã™ã‚‹ã¨ã€ `minikube` ãŒèµ·å‹•ã§ãã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

![Docker Desktop](/images/kubernetes-tutorial/DockerDesktop.png)

### Remote SSHæ¥ç¶šã®è¨­å®š

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ã¦ã€è‡ªç«¯æœ«ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹(IPv4)ã‚’äº‹å‰ã«èª¿ã¹ã¦ãŠãã¾ã™ã€‚

```bash:terminal
ifconfig
```

(å‚è€ƒ)  
<https://qiita.com/nlog2n2/items/1d1358f6913249f3e186>

Remote SSHã®configè¨­å®šã¯ã€ä»¥ä¸‹ã§é€²ã‚ã¦ã„ãã¾ã™ã€‚

```config:config
Host minikube
    HostName 127.0.0.1
    User root
```

é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ï¼ ãã®ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ ã«ã€èµ·å‹•ã—ã¦ã„ã‚‹ `minikube` ãŒã‚ã‚‹ã®ã§ã€  
èµ·å‹•ã—ã¦ã„ã‚‹ `minikube` ã¸æ¥ç¶šã—ã¾ã™ã€‚

![Remote SSH](/images/kubernetes-tutorial/editor_check.png)

æ¥ç¶šãŒå®Œäº†ã—ãŸã‚‰ä¸‹è¨˜ã®è¡¨ç¤ºã«ãªã‚‹ã®ã§ã€ `root` ã‚’é¸æŠã—ã¾ã™ã€‚

![root](/images/kubernetes-tutorial/minikube-root.png)

ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã‚‰ã€æ¥ç¶šã¨æº–å‚™ã®æ–¹ã¯å®Œäº†ã«ãªã‚Šã¾ã™ã€‚

![setup](/images/kubernetes-tutorial/minikube-access-after.png)

---

### Hello Worldï¼ï¼ˆKubernetesåˆå›å®Ÿè¡Œï¼‰

ãŠè©¦ã—ã«ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿å†…ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’èµ·å‹•ã—ã¦Kubernetesä¸Šã« `hello-world` Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨ã“ã‚ã¾ã§å®Ÿæ–½ã—ã¾ã™ã€‚

ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹å‰ã«æ³¨æ„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚  
ãã®ã¾ã¾ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã« `kubectl` ã‚³ãƒãƒ³ãƒ‰ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„ãŸã‚ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚  
ãã“ã§ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«æº–å‚™ã—ã¦ã„ãã¾ã™ã€‚

#### äº‹å‰æº–å‚™ï¼šminikubeã‚³ãƒ³ãƒ†ãƒŠå†…ã«kubectlã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚³ãƒ³ãƒ†ãƒŠå†…ã§kubectlã‚’ä½¿ã„ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ï¼š

```bash:minikube
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
```

```bash:minikube
chmod +x kubectl
```

```bash:minikube
mv kubectl /usr/local/bin/
```

#### kubeconfigã®è¨­å®š

kubectlã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€kubeconfigã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```bash:minikube
mkdir -p ~/.kube
```

```bash:minikube
cp /etc/kubernetes/admin.conf ~/.kube/config
```

```bash:minikube
chown $(id -u):$(id -g) ~/.kube/config
```

#### å‹•ä½œç¢ºèª

```bash:minikube
kubectl get nodes
```

å®Ÿè¡Œçµæœï¼š

```bash:minikube
NAME       STATUS   ROLES           AGE   VERSION
minikube   Ready    control-plane   85m   v1.33.1
```

#### hello-worldã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```bash:minikube
kubectl run hello-world --image hello-world --restart=Never
```

å®Ÿè¡Œçµæœï¼š

```bash:minikube
pod/hello-world created
```

**ã‚³ãƒãƒ³ãƒ‰è§£èª¬ï¼š**

- `kubectl` : Kubernetesã®ã‚³ãƒãƒ³ãƒ‰
- `run` : èµ·å‹•ã‚³ãƒãƒ³ãƒ‰
- `hello-world` : Kubernetesã®Podå
- `--image` : Kubernetesã®ã‚¤ãƒ¡ãƒ¼ã‚¸åã®æŒ‡å®š
- `hello-world` : Kubernetesã®ã‚¤ãƒ¡ãƒ¼ã‚¸å
- `--restart=Never` : èµ·å‹•æ–¹æ³•ã®æŒ‡å®šâ€»

â€»èµ·å‹•æ–¹æ³•ã«ã¯ `Always` ã‚„ `OnFailure`ãŒã‚ã‚‹ã€‚ä»¥ä¸‹å‚è€ƒã€‚  
<https://qiita.com/ssc-wkani/items/ee0930001c0663358392>

#### èµ·å‹•çŠ¶æ³ã®ç¢ºèª

å‡ºæ¥ä¸ŠãŒã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€`kubectl get pod` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:

```bash:minikube
kubectl get pod
```

å®Ÿè¡Œçµæœï¼š

```bash:minikube
NAME          READY   STATUS      RESTARTS   AGE
hello-world   0/1     Completed   0          10m
```

#### ãƒ­ã‚°ã®ç¢ºèª

ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ `kubectl logs pod/hello-world` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:

```bash:minikube
kubectl logs pod/hello-world
```

å®Ÿè¡Œçµæœï¼š

```bash:minikube
Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (arm64v8)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
```

#### ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

ä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒŠã®å‰Šé™¤ã‚’å®Ÿæ–½ã—ã¾ã™:

```bash:minikube
kubectl delete pod/hello-world
```

å®Ÿè¡Œçµæœï¼š

```bash:minikube
pod "hello-world" deleted
```

## ğŸ“‹ Kubernetesãƒªã‚½ãƒ¼ã‚¹ã®ç†è§£

### ãƒªã‚½ãƒ¼ã‚¹ã®åˆ†é¡

Kubernetesã®ä¸»ãªãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®é€šã‚Šã¨ãªã‚Šã¾ã™ã€‚

| åˆ†é¡         | ç¨®åˆ¥                                        |
| ------------ | ------------------------------------------- |
| ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ | Pod / ReplicaSet / Deployment / StatefulSet |
| ã‚µãƒ¼ãƒ“ã‚¹     | Service / Ingress                           |
| è¨­å®š         | ConfigMap / Secret                          |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸   | PersistentVolume / PersistentVolumeClaim    |

---

### ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ç³»ãƒªã‚½ãƒ¼ã‚¹

- **Pod**  
  æœ€å°å˜ä½ã€‚Dockerã‚³ãƒ³ãƒ†ãƒŠã®é›†åˆã€‚

- **ReplicaSet**  
  Podã®é›†åˆã€‚Podã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã§ãã‚‹ã€‚

- **Deployment**  
  ReplicaSetã®é›†åˆã€‚ReplicaSetã®ä¸–ä»£ç®¡ç†ãŒã§ãã‚‹ã€‚

- **StatefulSet**  
  Podã®é›†åˆã€‚Podã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹éš›ã®åå‰ãŒä¸€å®šã€‚

---

### ã‚µãƒ¼ãƒ“ã‚¹ç³»ãƒªã‚½ãƒ¼ã‚¹

- **Service**  
  å¤–éƒ¨å…¬é–‹ã€‚åå‰è§£æ±ºã€‚L4ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼â€»1ã€‚
- **Ingress**  
  å¤–éƒ¨å…¬é–‹ã€‚L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼â€»2ã€‚

:::details L4ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼4ï¼‰
**å‹•ä½œãƒ¬ãƒ™ãƒ«**: ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ï¼ˆTCP/UDPï¼‰  
**ç‰¹å¾´**ï¼š

- **IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆç•ªå·**ã®ã¿ã‚’è¦‹ã¦è² è·åˆ†æ•£ã‚’è¡Œã†
- ãƒ‘ã‚±ãƒƒãƒˆã®ä¸­èº«ï¼ˆHTTPãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ã¯è¦‹ãªã„
- é«˜é€Ÿã§å‡¦ç†ãŒè»½ã„
- ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ä¾å­˜ã—ãªã„

**è² è·åˆ†æ•£ã®ä¾‹**:

```txt
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ L4ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ â†’ ã‚µãƒ¼ãƒãƒ¼ç¾¤
   (IP:Port ã§æŒ¯ã‚Šåˆ†ã‘)
```

**ä½¿ç”¨ä¾‹**  
ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è² è·åˆ†æ•£  
ãƒ»ã‚²ãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ã®è² è·åˆ†æ•£  
ãƒ»å˜ç´”ãªWebã‚µãƒ¼ãƒãƒ¼ã®è² è·åˆ†æ•£  
:::

:::details L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼7ï¼‰
**å‹•ä½œãƒ¬ãƒ™ãƒ«**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆHTTP/HTTPSï¼‰  
**ç‰¹å¾´**ï¼š

- **HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã€URLã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**ã‚’è§£æã—ã¦è² è·åˆ†æ•£
- ã‚ˆã‚Šé«˜åº¦ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå¯èƒ½
- å‡¦ç†ãŒé‡ã„ï¼ˆãƒ‘ã‚±ãƒƒãƒˆã®ä¸­èº«ã‚’è§£æã™ã‚‹ãŸã‚ï¼‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®æ©Ÿèƒ½ã‚’æä¾›

**è² è·åˆ†æ•£ã®ä¾‹**:

```txt:ãŠé¡Œç›®
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ L7ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ â†’ ã‚µãƒ¼ãƒãƒ¼ç¾¤
            (URLã€ãƒ˜ãƒƒãƒ€ãƒ¼ç­‰ã§æŒ¯ã‚Šåˆ†ã‘)
```

:::

---

### è¨­å®šç³»ãƒªã‚½ãƒ¼ã‚¹

- **ConfigMap**  
  è¨­å®šæƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã€‚

- **Secret**  
  æ©Ÿå¾®æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã€‚

---

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç³»ãƒªã‚½ãƒ¼ã‚¹

- **PersistentVolume**  
  æ°¸ç¶šãƒ‡ãƒ¼ã‚¿ã®å®Ÿæ…‹ã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®æ¥ç¶šæƒ…å ±ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æŠ½è±¡åŒ–ã‚’è¡Œã†ã€‚
- **PersistentVolumeClaim**  
  æ°¸ç¶šãƒ‡ãƒ¼ã‚¿ã®è¦æ±‚ã€‚æŠ½è±¡åŒ–ã•ã‚ŒãŸã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è¦æ±‚ã‚’è¡Œã†ã€‚

## ğŸŒ Kubernetesãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç†è§£

### ãƒãƒ¼ãƒ‰ã¨Podã®åˆ†æ•£é…ç½®

ãƒªã‚½ãƒ¼ã‚¹ã¯å„ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã«åˆ†æ•£é…ç½®ã•ã‚Œã¾ã™ã€‚

**ãƒªã‚½ãƒ¼ã‚¹åˆ†æ•£ã®ç‰¹å¾´**  
â€¢ å„Workerãƒãƒ¼ãƒ‰ã«PodãŒåˆ†æ•£é…ç½®ã•ã‚Œã‚‹  
â€¢ SchedulerãŒãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ã‚’è€ƒæ…®ã—ã¦æœ€é©ãªãƒãƒ¼ãƒ‰ã‚’é¸æŠ  
â€¢ éšœå®³æ™‚ã®å½±éŸ¿ã‚’æœ€å°åŒ–ï¼ˆå˜ä¸€éšœå®³ç‚¹ã®å›é¿ï¼‰  
â€¢ è² è·åˆ†æ•£ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

```text
Kubernetes Cluster - ãƒªã‚½ãƒ¼ã‚¹ã®åˆ†æ•£é…ç½®
================================================

Control Plane (Master Node)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ API Server               â”‚
â”‚  â€¢ etcd                     â”‚
â”‚  â€¢ Scheduler                â”‚
â”‚  â€¢ Controller Manager       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼

Worker Node 1    Worker Node 2    Worker Node 3
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ kubelet   â”‚    â”‚ kubelet   â”‚    â”‚ kubelet   â”‚
â”‚ kube-proxyâ”‚    â”‚ kube-proxyâ”‚    â”‚ kube-proxyâ”‚
â”‚           â”‚    â”‚           â”‚    â”‚           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Pod A â”‚ â”‚    â”‚ â”‚ Pod C â”‚ â”‚    â”‚ â”‚ Pod E â”‚ â”‚
â”‚ â”‚ App1  â”‚ â”‚    â”‚ â”‚ App2  â”‚ â”‚    â”‚ â”‚ App3  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚    â”‚           â”‚    â”‚           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Pod B â”‚ â”‚    â”‚ â”‚ Pod D â”‚ â”‚    â”‚ â”‚ Pod F â”‚ â”‚
â”‚ â”‚ DB1   â”‚ â”‚    â”‚ â”‚ Cache â”‚ â”‚    â”‚ â”‚ Web   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡

Kubernetesã«ã¯ã€2ã¤ã®ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒå­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚

- **ã‚¯ãƒ©ã‚¹ã‚¿ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**  
  ã‚¯ãƒ©ã‚¹ã‚¿å†…éƒ¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€‚å¤–éƒ¨ã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ããªã„ã€‚
- **å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**  
  ç®¡ç†ç«¯æœ«ã¯å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã€‚

#### ã‚¯ãƒ©ã‚¹ã‚¿ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ§‹æˆè¦ç´ 

- **Pod Network**: Podé–“ã®ç›´æ¥é€šä¿¡ç”¨ï¼ˆCNIãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒç®¡ç†ï¼‰
- **Service Network:** ä»®æƒ³IPã«ã‚ˆã‚‹è² è·åˆ†æ•£ã¨ã‚µãƒ¼ãƒ“ã‚¹ç™ºè¦‹
- **Node Network:** ç‰©ç†çš„ãªãƒãƒ¼ãƒ‰é–“é€šä¿¡

#### å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã®æ¥ç¶šæ–¹æ³•

- **LoadBalancer**: ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å¤–éƒ¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼
- **NodePort**: å„ãƒãƒ¼ãƒ‰ã®ç‰¹å®šãƒãƒ¼ãƒˆã§å¤–éƒ¨å…¬é–‹
- **Ingress**: HTTP/HTTPSãƒ¬ãƒ™ãƒ«ã§ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åˆ¶å¾¡

#### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†é›¢ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **Namespace**: è«–ç†çš„ãªåˆ†é›¢
- **NetworkPolicy**: ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ¶å¾¡ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **CNI Plugin**: Podé–“é€šä¿¡ã®å®Ÿè£…ï¼ˆFlannel, Calico, Weaveç­‰ï¼‰

```text
é€šä¿¡ãƒ•ãƒ­ãƒ¼ä¾‹: å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ Pod ã¸ã®é€šä¿¡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. å¤–éƒ¨ã‹ã‚‰ã®é€šä¿¡
   Internet User (203.0.113.100)
   â”‚
   â”‚ HTTP Request
   â–¼
   Load Balancer (203.0.113.10:80)

2. ã‚¯ãƒ©ã‚¹ã‚¿å†…ã¸ã®è»¢é€
   â”‚
   â”‚ Forward to NodePort/Ingress
   â–¼
   Ingress Controller (10.96.1.100:80)
   â”‚
   â”‚ Route based on rules
   â–¼
   Service A (10.96.1.1:80)

3. Pod ã¸ã®è² è·åˆ†æ•£
   â”‚
   â”‚ Load Balance (kube-proxy)
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â–¼             â–¼             â–¼
   Pod A         Pod C         Pod E
   (10.244.1.10) (10.244.2.10) (10.244.3.10)
   Node 1        Node 2        Node 3

4. Podé–“é€šä¿¡ (åŒä¸€Serviceå†…)
   Pod A (10.244.1.10) â†â†’ Pod C (10.244.2.10)
   â”‚                        â”‚
   â”‚ CNI Plugin (Flannel/Calico/Weave)
   â”‚                        â”‚
   Node 1 â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Node 2
   (192.168.1.10)           (192.168.1.11)
```

---

### ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•

ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã¨ã—ã¦ã€ä»¥ä¸‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ï¼š

- ã‚³ãƒ³ãƒ†ãƒŠã«ç›´æ¥ãƒ­ã‚°ã‚¤ãƒ³
- è¸ã¿å°ã‚µãƒ¼ãƒçµŒç”±ã§ã‚³ãƒ³ãƒ†ãƒŠã¸ã‚¢ã‚¯ã‚»ã‚¹
- ã‚µãƒ¼ãƒ“ã‚¹çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹

## âš™ï¸ Kubernetesã®åŸºæœ¬æ“ä½œ

### ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆãƒ»å¤‰æ›´ãƒ»ç¢ºèªãƒ»å‰Šé™¤

#### åŸºæœ¬çš„ãªä½œæˆæ‰‹é †

ã€Œ**å®šç¾©ä½œæˆ**ã€ã€€â†’ã€€ã€Œ**å®šç¾©é©ç”¨**ã€  
ã®é †ã§ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

```txt:ä½œæˆæ‰‹é †
ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼šYAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
â†“
Kubernetesåæ˜ ï¼škubectlã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã—ã¦åæ˜ 
```

#### ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒªã‚½ãƒ¼ã‚¹ã®å®šç¾©ã‚’è¨˜è¼‰ã—ã¾ã™:

**ä¾‹ï¼š**

```yaml:pod.yml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: default
  labels:
    app: nginx
    env: test
spec:
  containers:
    - name: nginx-container
      image: nginx:1.17.2-alpine
```

**ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆãƒ»å¤‰æ›´**:
ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã€å¤‰æ›´ã—ã¾ã™:

```bash:minikube
kubectl apply -f <filename>
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³**  
`-f <filename>` ï¼š ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

---

**ãƒªã‚½ãƒ¼ã‚¹ç¢ºèªã‚³ãƒãƒ³ãƒ‰**
æŒ‡å®šã—ãŸãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
kubectl get [-f <filename>] [TYPE]
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³**  
`-f <filename>` ï¼š ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹  
`TYPE` ï¼š ãƒªã‚½ãƒ¼ã‚¹ç¨®åˆ¥ï¼ˆpod, replicaset ãªã©ï¼‰

---

**ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰**
æŒ‡å®šã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¾ã™:

```bash:minikube
kubectl delete [-f <filename>] [TYPE/NAME] [-o [wide|yaml]]
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³**  
`-f <filename>` ï¼š ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹  
`TYPE/NAME -o [wide|yaml]` ï¼š å‡ºåŠ›å½¢å¼ã‚’æŒ‡å®šã—ã¾ã™ã€‚  
â€»wideï¼šè¿½åŠ æƒ…å ±ã®è¡¨ç¤º, yamlï¼šYAMLå½¢å¼ã§è¡¨ç¤º

---

### ğŸ’¡ å­¦ç¿’ç¶™ç¶šã®ãŸã‚ã®Tips

å­¦ç¿’é€”ä¸­ã§ `minikube` ã‚’é€”ä¸­ã§åœæ­¢ã—å¾Œæ—¥å†é–‹ã™ã‚‹éš›ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã®æ“ä½œæ–¹æ³•ã‚’ä»¥ä¸‹ã®æ‰‹é †ã§é€²ã‚ã¦ã„ãã¨å­¦ç¿’ã‚’å†é–‹ã§ãã¾ã™ã€‚

**â€»å‰ææ¡ä»¶ï¼šRemote SSHã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€ã‹ã¤ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§minikubeã‚’èµ·å‹•ã—ã¦ã„ã‚‹**:

1. ç”»é¢å·¦ä¸‹ã®Remote SSHã‚’æŠ¼ä¸‹
2. å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«ã‚¢ã‚¿ãƒƒãƒã‚’æŠ¼ä¸‹

![minikube-open-tips](/images/kubernetes-tutorial/minikube-open-tips.png)

---

### å®Ÿè·µæ¼”ç¿’ï¼šPodã®ä½œæˆã‹ã‚‰å‰Šé™¤ã¾ã§

ä½œæˆæ‰‹é †ã§è¨˜è¼‰ã—ãŸã‚³ãƒãƒ³ãƒ‰ã‚’ã€å®Ÿéš›ã«æ¼”ç¿’å½¢å¼ã§é€²ã‚ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

**ğŸ“– æ¼”ç¿’å†…å®¹**:

1. nginxã‚³ãƒ³ãƒ†ãƒŠã‚’å«ã‚€Podã‚’ä½œæˆ
2. PodãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
3. Podã‚’å‰Šé™¤

#### Step 1: Podã®ä½œæˆ

**ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèª**:

```bash:minikube
root@minikube:~# pwd
/root
root@minikube:~#
```

**ä½œæ¥­ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ**:

åå‰ã¯ä½•ã§ã‚‚ã‚ˆã„ã§ã™ãŒã€ã¨ã‚Šã‚ãˆãš `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦ãŠãã¾ã™:

```bash:minikube
root@minikube:~# mkdir ./tutorial
```

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆç¢ºèª**:

`root` ç›´ä¸‹ã« `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~# ls -l
total 4
drwxr-xr-x 2 root root 4096 May 27 23:05 tutorial
root@minikube:~#
```

**ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**:

`tutorial` ç›´ä¸‹ã« `pod.yml` ã‚’ä½œæˆã—ã¾ã™:

:::details pod.yml

```yaml:tutorial/pod.yml
# Kubernetes APIã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šï¼ˆPod ãƒªã‚½ãƒ¼ã‚¹ã¯v1ï¼‰
apiVersion: v1
# ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ã‚’æŒ‡å®šï¼ˆã“ã®å ´åˆã¯Podï¼‰
kind: Pod
# Podã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æƒ…å ±
metadata:
  # Podã®åå‰
  name: nginx
  # PodãŒä½œæˆã•ã‚Œã‚‹åå‰ç©ºé–“ï¼ˆçœç•¥å¯èƒ½ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯defaultï¼‰
  namespace: default
  # Podã«ä»˜ä¸ã™ã‚‹ãƒ©ãƒ™ãƒ«ï¼ˆã‚»ãƒ¬ã‚¯ã‚¿ã‚„ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ä½¿ç”¨ï¼‰
  labels:
    app: nginx # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’ç¤ºã™ãƒ©ãƒ™ãƒ«
    env: test # ç’°å¢ƒã‚’ç¤ºã™ãƒ©ãƒ™ãƒ«ï¼ˆtest, prod, devãªã©ï¼‰
# Podã®ä»•æ§˜ãƒ»è¨­å®š
spec:
  # Podå†…ã§å®Ÿè¡Œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®ãƒªã‚¹ãƒˆ
  containers:
    # ã‚³ãƒ³ãƒ†ãƒŠã®åå‰
    - name: nginx-container
      # ä½¿ç”¨ã™ã‚‹Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã‚¿ã‚°
      image: nginx:1.17.2-alpine
```

:::

#### Step 2: Podã®èµ·å‹•ç¢ºèª

**ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•**:

```bash:minikube
root@minikube:~# cd tutorial
root@minikube:~/tutorial#
```

**ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆ**:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f pod.yml
pod/nginx created
root@minikube:~/tutorial#
```

**ä½œæˆã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª**:

```bash:minikube
root@minikube:~/tutorial# kubectl get pod
NAME    READY   STATUS              RESTARTS   AGE
nginx   0/1     ContainerCreating   0          52s
root@minikube:~/tutorial#
```

#### Step 3: Podã®å‰Šé™¤

**ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤**:

```bash:minikube
root@minikube:~/tutorial# kubectl delete -f pod.yml
pod "nginx" deleted
root@minikube:~/tutorial#
```

**å‰Šé™¤ã®ç¢ºèª**:

```bash:minikube
root@minikube:~/tutorial# kubectl get pod
No resources found in default namespace.
root@minikube:~/tutorial#
```

---

### ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡

å‰æ®µã§ã¯ã€Podã®ä½œæˆãƒ»ç¢ºèªãƒ»å‰Šé™¤ã‚’è¡Œã„ã¾ã—ãŸã€‚  
ã“ã“ã§ã¯ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ã«ã¤ã„ã¦è¨˜è¼‰ã—ã¾ã™ã€‚

#### ãã‚‚ãã‚‚ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã£ã¦ä½•ï¼Ÿ

- ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã§æ§‹é€ ã‚’å®šç¾©ã™ã‚‹YAMLãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®ã“ã¨ã€‚
- ç¨®åˆ¥ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€ã‚³ãƒ³ãƒ†ãƒŠã®3æ§‹æˆã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã€‚
  â€»ãƒªã‚½ãƒ¼ã‚¹ã«ã‚ˆã£ã¦å®šç¾©ã®ä¸­èº«ã«å¤‰å‹•ã‚ã‚Š

å‰æ®µã§èª¬æ˜ã—ã¾ã—ãŸ `pod.yml` ã«ã¤ã„ã¦ã€æ”¹ã‚ã¦è©³ç´°ã®èª¬æ˜ã‚’è¨˜è¼‰ã—ãŸã„ã¨æ€ã„ã¾ã™:

::: details tutorial/pod.yml

```yaml:tutorial/pod.yml
# kind ã¨ apiVersion
apiVersion: v1
kind: Pod
# metadata ã¨ nameã€namespaceã€labels
metadata:
  name: nginx
  namespace: default
  labels:
    app: nginx # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’ç¤ºã™ãƒ©ãƒ™ãƒ«
    env: test # ç’°å¢ƒã‚’ç¤ºã™ãƒ©ãƒ™ãƒ«ï¼ˆtest, prod, devãªã©ï¼‰
# ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®š
spec:
  containers:
    - name: nginx-container
      image: nginx:1.17.2-alpine
```

:::

#### kind ã¨ apiVersion

- ãƒªã‚½ãƒ¼ã‚¹ç¨®åˆ¥ã€‚
- kindã«ã‚ˆã£ã¦ã€apiVersionã®å€¤ãŒå¤‰ã‚ã‚‹ã€‚

#### metadata ã¨ nameã€namespaceã€labels

- Podåã¯åå‰ç©ºé–“ã¨åˆã‚ã›ã¦ä¸€æ„ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
  â€»namespaceã‚’çœç•¥ã—ãŸå ´åˆã¯ã€defaultãŒé©ç”¨ã•ã‚Œã‚‹ã€‚
- labelsã¯ã‚»ãƒ¬ã‚¯ã‚¿ã‚„ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚
- labelsã¯è¤‡æ•°æŒ‡å®šå¯èƒ½ã€‚

#### spec

- ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã€‚
- è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’æŒ‡å®šå¯èƒ½ã€‚
- ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã¯è¤‡æ•°æŒ‡å®šå¯èƒ½ã€‚

---

ä¾‹é¡Œã«ã¯è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã›ã‚“ãŒã€ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™:

::: details pod.yml

```yaml:pod.yml
ã€œèª¬æ˜ç”¨ã®ãŸã‚ã€specã‹ã‚‰ä¸Šã¯çœç•¥ã€œ
spec:
  containers:
    - name: nginx
      image: nginx:1.17.2-alpine
      # command ã¨ args ã®è¨­å®š
      command: ["/bin/sh"]
      args: ["-c", "while true; do echo hello; sleep ${DELAY}; done"]
      # env ã®è¨­å®š
      env:
      - name: "DELAY"
        value: "5"
```

:::

#### command ã¨ args

- ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã¨å¼•æ•°ã‚’æŒ‡å®šã™ã‚‹ã€‚
- commandã¯ã‚³ãƒãƒ³ãƒ‰åã€argsã¯å¼•æ•°ã€‚
- commandã¯1ã¤ã€argsã¯è¤‡æ•°æŒ‡å®šå¯èƒ½ã€‚
- commandã¨argsã¯ã©ã¡ã‚‰ã‹ä¸€æ–¹ã®ã¿æŒ‡å®šå¯èƒ½ã€‚
- commandã¨argsã®ä¸¡æ–¹ã‚’æŒ‡å®šã—ãŸå ´åˆã€commandã®ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚
- ä¾‹é¡Œã§ã®è¨­å®šã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦`ã‹ã‚‰5ç§’ã”ã¨ã«ã€Œhelloã€ã¨è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãªä¾‹é¡Œã€‚

#### env

- ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä½¿ç”¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã€‚
- nameã¯ç’°å¢ƒå¤‰æ•°åã€valueã¯å€¤ã€‚
- envã¯è¤‡æ•°æŒ‡å®šå¯èƒ½ã€‚
- envã¯commandã¨argsã®å¾Œã«è¨˜è¼‰ã™ã‚‹ã€‚
- ä¾‹é¡Œã§ã®è¨­å®šã§ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç’°å¢ƒå¤‰æ•°ã€ŒDELAYã€ã‚’5ã«è¨­å®šã—ã¦ã„ã‚‹ã€‚

---

### kindã«å¿œã˜ãŸ apiVersion ã®ç¢ºèª

å†æ²ã«ãªã‚Šã¾ã™ãŒã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ **kind ã«å¿œã˜ãŸ apiVersion ã‚’æŒ‡å®š** ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
ãã“ã§ã€kindã«å¿œã˜ãŸ apiVersion ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

çµè«–ã«ãªã‚Šã¾ã™ãŒã€ Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®[Kubernetes APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://kubernetes.io/docs/reference/kubernetes-api/)ã‚’å‚ç…§ã™ã‚‹ã¨ç¢ºèªã§ãã¾ã™ã€‚

ä¾‹ãˆã°å‰æ®µã§ã‚‚è¨˜è¼‰ã—ãŸ `pod.yml` ã® apiVersion ã¯ `v1` ã¨ãªã£ã¦ãŠã‚Šã€ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã¯ä¸‹è¨˜ã«è©²å½“ã—ã¾ã™ã€‚  
[kubeconfig(v1)](https://kubernetes.io/docs/reference/config-api/kubeconfig.v1/)

---

### Pod ã«å…¥ã£ã¦ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

èµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã¸å…¥ã‚Šã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚  
å„ç¨®ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

**â–¼ã‚³ãƒ³ãƒ†ãƒŠã¸å…¥ã‚‹**:  
ã“ã®æ§‹æ–‡ã¯ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ§‹æ–‡ã®ãŸã‚èª¤ã‚Šã¨ãªã‚Šã¾ã™ã€‚  
æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ§‹æ–‡ã¯å¾Œè¿°ã§è¨˜è¼‰ã—ã¾ã™ã®ã§ã€ä¸‹è¨˜ã¯ç„¡è¦–ã—ã¦ãã ã•ã„ğŸ™‡â€â™‚ï¸

```bash:minikube
kubectl exec -it POD sh
```

ãƒ»å¼•æ•°  
`POD`ï¼šä¸­ã«å…¥ã‚ŠãŸã„Podå

**â–¼ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã‚‹**:

ãƒ»ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†ã—ã¦ã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

```bash:minikube
exit
```

ãƒ»ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ®‹ã—ãŸã¾ã¾ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

```bash:minikube
[ctrl + P] + [ctrl + Q]
```

#### æ¼”ç¿’

**ğŸ“– æ¼”ç¿’å†…å®¹**:

```txt:ãŠé¡Œç›®
1. `CentOS` ã¨ `nginx` ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. `CentOS` ã¨ ``nginx` ã®Podã‚’èµ·å‹•
3. Podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèª
4. èµ·å‹•ã—ãŸ `CentOS` ã‚³ãƒ³ãƒ†ãƒŠã¨ `nginx` ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚‹
5. ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã‚‹
6. `CentOS` ã¨ ``nginx` ã®Podã‚’å‰Šé™¤
```

1.ã¾ãšã¯ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã‹ã‚‰SSHã§æ¥ç¶šã—ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚  
â€»å‰æ®µã®æ¼”ç¿’ã§ä½¿ç”¨ã—ãŸ `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ã„ã¾ã‚ã—ã€ãã®é…ä¸‹ã« `pods.yml` ã‚’ä½œæˆã—ã¾ã™:

::: details tutorial/pods.yml

```yaml:tutorial/pods.yml
# CentOS Pod ã®å®šç¾©
apiVersion: v1
kind: Pod
metadata:
  name: debug
  namespace: default
  labels:
    env: test
spec:
  containers:
    - name: debug
      image: centos:7
      command:
        - sh    # ã‚·ã‚§ãƒ«ã‚’èµ·å‹•
        - -c    # ã‚³ãƒãƒ³ãƒ‰æ–‡å­—åˆ—ã‚’å®Ÿè¡Œã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³
      # commandã«æ¸¡ã™å¼•æ•°
      args:
        - |
          while true
          do
      # ç’°å¢ƒå¤‰æ•°DELAYã®å€¤ã ã‘ã‚¹ãƒªãƒ¼ãƒ—ã™ã‚‹
            sleep ${DELAY}
          done
      # ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä½¿ç”¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°
      env:
        - name: "DELAY"
          value: "5"

---  # YAMLæ–‡æ›¸ã®åŒºåˆ‡ã‚Šæ–‡å­—

# nginx Pod ã®å®šç¾©
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: default
  labels:
    env: test
spec:
  containers:
    - name: nginx-container
      image: nginx:1.17.2-alpine
```

:::

**â€»æ³¨æ„**:  
ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«è¤‡æ•°ã®å®šç¾©ã‚’è¨˜è¼‰ã™ã‚‹éš›ã€å¿…ãš **`---`** ã§åŒºåˆ‡ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
ãã†ã—ãªã‘ã‚Œã°ã€ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆãŒå¤±æ•—ã—ã¾ã™ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚

2.ä½œæˆã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ·å‹•ã•ã›ã¾ã™ã€‚

ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™:

```bash:minikube
root@minikube:~# cd tutorial/
root@minikube:~/tutorial#
```

ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆã‚’å®Ÿè¡Œã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f pods.yml
pod/debug created
pod/nginx created
root@minikube:~/tutorial#
```

3.ä½œæˆã—ãŸPodã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ã¾ã™ã€‚  
`-o wide` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€Podã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã§ãã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl get pod -o wide
NAME    READY   STATUS             RESTARTS   AGE     IP            NODE       NOMINATED NODE   READINESS GATES
debug   0/1     ImagePullBackOff   0          3m57s   10.244.0.18   minikube   <none>           <none>
nginx   1/1     Running            0          3m57s   10.244.0.17   minikube   <none>           <none>
root@minikube:~/tutorial#
```

4.æ¬¡ã«ã€æœ¬é¡Œã®ã‚³ãƒ³ãƒ†ãƒŠã¸ã®å…¥ã‚Šæ–¹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚  
`debug` ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚Šã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl exec -it debug sh
error: exec [POD] [COMMAND] is not supported anymore. Use exec [POD] -- [COMMAND] instead
See 'kubectl exec -h' for help and examples
root@minikube:~/tutorial#
```

ãƒ»ãƒ»ãƒ»ï¼Ÿ
ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã„ã¾ã—ãŸã€‚  
`kubectl exec` ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆãªã„ã‚ˆã†ã§ã™ã€‚  
ã“ã‚Œã¯ã€Kubernetes v1.24ã‹ã‚‰ æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®kubectlã§ã¯ã€ã‚³ãƒãƒ³ãƒ‰ã®å‰ã« `--` ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã ãã†ã§ã™ã€‚  
`kubectl exec -it POD sh` ã‚³ãƒãƒ³ãƒ‰ã®ä»£ã‚ã‚Šã«ã€ `kubectl exec -it POD -- ssh` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚  
ã“ã‚Œã§ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚‹ã“ã¨ãŒã§ã‚‹ã¯ãšã§ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl exec -it debug -- sh
sh-4.2#
```

å…¥ã‚Œã¾ã—ãŸï¼  
`exit` ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã¦ã€æ®‹ã‚Šã® `nginx` ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl exec -it nginx -- sh
/ #
```

**è£œè¶³ï¼šã‚³ãƒ³ãƒ†ãƒŠã¸å…¥ã‚‹(æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³)**:

```bash:minikube
kubectl exec -it POD -- sh
```

ãƒ»å¼•æ•°  
`POD`ï¼šä¸­ã«å…¥ã‚ŠãŸã„Podå

`--` ã¯ã€**ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã‚’Podå†…ã®ã‚·ã‚§ãƒ«ã«æ¸¡ã™ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™**ã€‚
`kubectl exec` ã‚³ãƒãƒ³ãƒ‰ã®æ§‹æ–‡å¤‰æ›´ã«ã¤ã„ã¦ã€è©³ç´°ã¯[ã“ã¡ã‚‰](https://kubernetes.io/ja/docs/tasks/debug/debug-application/get-shell-running-container/)ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

```txt:èª¬æ˜
ã“ã®å¤‰æ›´ã¯ã€Kubernetesã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ä¸€è²«æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«å°å…¥ã•ã‚Œã¾ã—ãŸï¼š

- `--` ã¯ã‚³ãƒãƒ³ãƒ‰ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã¾ã™
- ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®ãƒªã‚¹ã‚¯ã‚’è»½æ¸›ã—ã¾ã™
- ä»–ã®kubectlã‚³ãƒãƒ³ãƒ‰ã¨ã®ä¸€è²«æ€§ã‚’ä¿ã¡ã¾ã™
```

5.ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ `exit` ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã¾ã™ã€‚

6.æœ€å¾Œã«ã€ä½œæˆã—ãŸPodã‚’å‰Šé™¤ã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl delete -f pods.yml
pod "debug" deleted
pod "nginx" deleted
root@minikube:~/tutorial#
```

---

### Pod ã¨ãƒ›ã‚¹ãƒˆé–“ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚„ã‚Šå–ã‚Š

Podå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ›ã‚¹ãƒˆå´ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã«ã¯ã€`kubectl cp` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚  
ä¸‹è¨˜ã¯ãã‚Œãã‚Œã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ã‚³ãƒãƒ³ãƒ‰ã®ä¾‹ã§ã™ã€‚  
å…±é€šã—ã¦ã€PODNAMEã®å¾Œã«ã¯è»¢é€å…ƒã¨è»¢é€å…ˆã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è¨˜è¼‰ã™ã‚‹å‰ã«ã€**`:`** ã‚’ä»˜ã‘ã¦ãã ã•ã„ã€‚

**â–¼ãƒ›ã‚¹ãƒˆå´ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Podå†…ã«ã‚³ãƒ”ãƒ¼**
åŸºæœ¬æ§‹æ–‡:

```bash:minikube
kubectl cp SRC PODNAME:DEST
```

ãƒ»å¼•æ•°
`SRC`: ãƒ›ã‚¹ãƒˆå´ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹  
`PODNAME`: Podã®åå‰  
`DEST`: Podå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

**â–¼Podå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ›ã‚¹ãƒˆå´ã«ã‚³ãƒ”ãƒ¼**
åŸºæœ¬æ§‹æ–‡:

```bash:minikube
kubectl cp PODNAME:SRC DEST
```

ãƒ»å¼•æ•°
`PODNAME`: Podã®åå‰  
`SRC`: Podå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹  
`DEST`: ãƒ›ã‚¹ãƒˆå´ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹

**ğŸ“– æ¼”ç¿’å†…å®¹**:

```txt:ãŠé¡Œç›®
1. `CentOS` ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. `CentOS` ã®Podã‚’èµ·å‹•
3. `sample.txt` ã‚’ã€ä½œæˆã—ãŸ `CentOS` ã‚³ãƒ³ãƒ†ãƒŠå†…ã® `/var/tmp` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸è»¢é€
4. ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ãƒ›ã‚¹ãƒˆå´ã«ã‚³ãƒ”ãƒ¼
5. ä½œæ¥­å¾Œã®Podã‚’å‰Šé™¤
```

1.ã¾ãšã¯ä»»æ„ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã‹ã‚‰SSHã§æ¥ç¶šã—ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚  
â€»å‰æ®µã®æ¼”ç¿’ã§ä½¿ç”¨ã—ãŸ `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ã„ã¾ã‚ã—ã€ãã®é…ä¸‹ã« `pod.yml` ã¨ `sample.txt` ã‚’ä½œæˆã—ã¾ã™:

::: details tutorial/pod.yml, tutorial/sample.txt

```yaml:tutorial/pod.yml
apiVersion: v1
kind: Pod
metadata:
  name: debug
  namespace: default
  labels:
    env: test
spec:
  containers:
    - name: debug
      image: centos:7
      command:
        - "sh"
        - "-c"
      args:
        - |
          while true
          do
            sleep ${DELAY}
          done
      env:
        - name: "DELAY"
          value: "5"
```

```bash:tutorial/sample.txt
Hello World !
```

:::

2.ä½œæˆã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ·å‹•ã•ã›ã¾ã™ã€‚  
ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™:

```bash:minikube
root@minikube:~# cd tutorial/
root@minikube:~/tutorial#
```

ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆã‚’å®Ÿè¡Œã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f pod.yml
pod/debug created
root@minikube:~/tutorial#
```

ä½œæˆã§ããŸã“ã¨ã‚’å¿µã®ãŸã‚ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl get pod
NAME    READY   STATUS    RESTARTS   AGE
debug   1/1     Running   0          85s
root@minikube:~/tutorial#
```

3.ãƒ›ã‚¹ãƒˆå†…ã«ä½œæˆã—ãŸ `sample.txt` ã‚’ã€ä½œæˆã—ãŸ `CentOS` ã‚³ãƒ³ãƒ†ãƒŠå†…ã® `/var/tmp` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸è»¢é€ã—ã¾ã™ã€‚  
ã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã€è»¢é€å…ˆã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl cp ./sample.txt debug:/var/tmp/sample_transfer.txt
root@minikube:~/tutorial#
```

ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒè»¢é€ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl exec -it debug -- sh
sh-4.2# ls /var/tmp/sample_transfer.txt
/var/tmp/sample_transfer.txt
sh-4.2#
```

4.ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ãƒ›ã‚¹ãƒˆå´ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚  
æ‰‹é †ã¨ã—ã¦ã¯ã€ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ `vi` ã‚³ãƒãƒ³ãƒ‰ã§ `Received Successfully!` ã¨è¨˜è¼‰ã—ã¾ã™ã€‚  
ãã®å¾Œã«ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦ã€ãƒ›ã‚¹ãƒˆå´ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™:

```bash:minikube
sh-4.2# ~
sh-4.2# touch /var/tmp/sample_receive.txt
sh-4.2# ls /var/tmp/sample_receive.txt
/var/tmp/sample_receive.txt
sh-4.2# vi /var/tmp/sample_receive.txt
sh-4.2# cat /var/tmp/sample_receive.txt
Received Successfully!
sh-4.2# exit
exit
root@minikube:~/tutorial# kubectl cp debug:/var/tmp/sample_receive.txt ./sample_receive.txt
tar: Removing leading `/' from member names
root@minikube:~/tutorial# cat ./sample_receive.txt
Received Successfully!
root@minikube:~/tutorial#
```

5.æœ€å¾Œã«ã€ä½œæˆã—ãŸPodã‚’å‰Šé™¤ã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl delete -f pod.yml
pod "debug" deleted
root@minikube:~/tutorial#
```

---

### çŠ¶æ…‹/ãƒ­ã‚°ã®ç¢ºèª

çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹éš›ã¯ã€`kubectl describe` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

**â–¼Podã®çŠ¶æ…‹ã‚’ç¢ºèª**
åŸºæœ¬æ§‹æ–‡:

```bash:minikube
kubectl describe [TYPE/NAME]
```

ãƒ»å¼•æ•°
`TYPE`: ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡  
`NAME`: ãƒªã‚½ãƒ¼ã‚¹ã®åå‰

**â–¼ãƒ­ã‚°ã®è©³ç´°ã‚’ç¢ºèª**
åŸºæœ¬æ§‹æ–‡:

```bash:minikube
kubectl logs [TYPE/NAME] [--tail=n]
```

ãƒ»å¼•æ•°
`TYPE`: ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡  
`NAME`: ãƒªã‚½ãƒ¼ã‚¹ã®åå‰  
`--tail=n`: ãƒ­ã‚°ã®æœ€å¾Œã‹ã‚‰nè¡Œã‚’è¡¨ç¤º

**â–¼Podã®ãƒ­ã‚°ã‚’ç¢ºèª**
åŸºæœ¬æ§‹æ–‡:

```bash
kubectl logs [POD]
```

ãƒ»å¼•æ•°
`POD`: Podã®åå‰

**ğŸ“– æ¼”ç¿’å†…å®¹**:

```txt:ãŠé¡Œç›®
1. `CentOS` ã¨ `nginx` ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—èµ·å‹•
2. `CentOS` ã¨ `nginx` ã®Podã®çŠ¶æ…‹ã‚’ç¢ºèª
3. `CentOS` ã«å…¥ã‚‹
4. `curl` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ `nginx` ã®ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¯ã‚»ã‚¹
5. `CentOS` ã‹ã‚‰å‡ºã‚‹
6. `nginx` ã®Podã®ãƒ­ã‚°ã‚’ç¢ºèª
7. `nginx` ã®Podã‚’å‰Šé™¤
```

1.`CentOS` ã¨ `nginx` ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—èµ·å‹•ã—ã¾ã™ã€‚  
â€»å‰æ®µã®æ¼”ç¿’ã§ä½¿ç”¨ã—ãŸ `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ã„ã¾ã‚ã—ã€ãã®é…ä¸‹ã« `pods.yml` ã‚’ä½œæˆã—ã¾ã™:

::: details tutorial/pods.yml

```yaml:tutorial/pods.yml
apiVersion: v1
kind: Pod
metadata:
  name: debug
  namespace: default
spec:
  containers:
    - name: debug
      image: centos:7
      command:
        - "sh"
        - "-c"
      args:
        - |
          while true
          do
            sleep ${DELAY}
          done
      env:
        - name: "DELAY"
          value: "86400"

---
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.17.2-alpine
```

:::

èµ·å‹•ã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f pods.yml
pod/debug created
pod/nginx created
root@minikube:~/tutorial#
```

2.ä½œæˆã—ãŸPodã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™ã€‚  
æ‰‹å§‹ã‚ã«ã€ `debug` ã®Podã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™:

::: details kubectl describe pod/debug

```bash:minikube
root@minikube:~/tutorial# kubectl describe pod/debug
Name:             debug
Namespace:        default
Priority:         0
Service Account:  default
Node:             minikube/192.168.49.2
Start Time:       Fri, 30 May 2025 12:45:04 +0000
Labels:           <none>
Annotations:      <none>
Status:           Running
IP:               10.244.0.26
IPs:
  IP:  10.244.0.26
Containers:
  debug:
    Container ID:  docker://c0da926ebe2fc2b33718b24d2edf01480554e005fd0f2a3b770ede18b6641110
    Image:         centos:7
    Image ID:      docker-pullable://centos@sha256:be65f488b7764ad3638f236b7b515b3678369a5124c47b8d32916d6487418ea4
    Port:          <none>
    Host Port:     <none>
    Command:
      sh
      -c
    Args:
      while true
      do
        sleep ${DELAY}
      done

    State:          Running
      Started:      Fri, 30 May 2025 12:45:05 +0000
    Ready:          True
    Restart Count:  0
    Environment:
      DELAY:  86400
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-bfm2w (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True
  Initialized                 True
  Ready                       True
  ContainersReady             True
  PodScheduled                True
Volumes:
  kube-api-access-bfm2w:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    Optional:                false
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  115s  default-scheduler  Successfully assigned default/debug to minikube
  Normal  Pulled     115s  kubelet            Container image "centos:7" already present on machine
  Normal  Created    115s  kubelet            Created container: debug
  Normal  Started    115s  kubelet            Started container debug
root@minikube:~/tutorial# nning   0          10s
root@minikube:~/
```

:::

`Events` ã®éƒ¨åˆ†ã«æ³¨ç›®ã™ã‚‹ã¨ã€Podã®ä½œæˆãƒ»èµ·å‹•ãƒ»çµ‚äº†ãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚  
æ¬¡ã«ã€ `nginx` ã®Podã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™:

::: details kubectl describe pod/nginx

```bash:minikube
root@minikube:~/tutorial# kubectl describe pod/nginx
Name:             nginx
Namespace:        default
Priority:         0
Service Account:  default
Node:             minikube/192.168.49.2
Start Time:       Fri, 30 May 2025 12:45:04 +0000
Labels:           <none>
Annotations:      <none>
Status:           Running
IP:               10.244.0.25
IPs:
  IP:  10.244.0.25
Containers:
  nginx:
    Container ID:   docker://d8de6b8d4ccfce54ac151c3480204162fc57458c4075a699a456b522d2d00cdb
    Image:          nginx:1.17.2-alpine
    Image ID:       docker-pullable://nginx@sha256:482ead44b2203fa32b3390abdaf97cbdc8ad15c07fb03a3e68d7c35a19ad7595
    Port:           <none>
    Host Port:      <none>
    State:          Running
      Started:      Fri, 30 May 2025 12:45:05 +0000
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-v2j8z (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True
  Initialized                 True
  Ready                       True
  ContainersReady             True
  PodScheduled                True
Volumes:
  kube-api-access-v2j8z:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    Optional:                false
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age    From               Message
  ----    ------     ----   ----               -------
  Normal  Scheduled  4m15s  default-scheduler  Successfully assigned default/nginx to minikube
  Normal  Pulled     4m15s  kubelet            Container image "nginx:1.17.2-alpine" already present on machine
  Normal  Created    4m15s  kubelet            Created container: nginx
  Normal  Started    4m15s  kubelet            Started container nginx
root@minikube:~/tutorial#
```

:::

`debug` ã®Podã¨åŒæ§˜ã«ã€`nginx` ã®Podã®çŠ¶æ…‹ã‚‚ç¢ºèªã§ãã¾ã—ãŸã€‚

3.`CentOS` ã®Podã«æ¥ç¶šã—ã¦ `nginx` ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚  
ãã®å‰ã«ã€ä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒŠã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl get pod -o wide
NAME    READY   STATUS    RESTARTS   AGE     IP            NODE       NOMINATED NODE   READINESS GATES
debug   1/1     Running   0          8m57s   10.244.0.26   minikube   <none>           <none>
nginx   1/1     Running   0          8m57s   10.244.0.25   minikube   <none>           <none>
root@minikube:~/tutorial#
```

æœ¬é¡Œã®`CentOS` ã®Podã«æ¥ç¶šã—ã¦ `nginx` ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl exec -it debug -- sh
sh-4.2#
```

`nginx` ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã¾ã™:

::: details curlå®Ÿè¡Œçµæœ

```bash:minikube
sh-4.2# curl 10.244.0.25
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
sh-4.2#
```

:::

ã‚¢ã‚¯ã‚»ã‚¹æˆåŠŸã§ã™ï¼

5.6. ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã¦ã€`nginx` ã®Podã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
sh-4.2# exit
exit
root@minikube:~/tutorial# kubectl logs pod/nginx
10.244.0.26 - - [30/May/2025:12:55:58 +0000] "GET / HTTP/1.1" 200 612 "-" "curl/7.29.0" "-"
root@minikube:~/tutorial#
```

`nginx` ã®Podã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

7.Podã‚’å‰Šé™¤ã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl delete -f pods.yml
pod "debug" deleted
pod "nginx" deleted
root@minikube:~/tutorial#
```

## ğŸ“• Kubernetesãƒªã‚½ãƒ¼ã‚¹

ãƒªã‚½ãƒ¼ã‚¹ã«ã¤ã„ã¦ã¯ ã€ŒğŸ“‹ Kubernetesãƒªã‚½ãƒ¼ã‚¹ã®ç†è§£ã€ ã®ç« ã§ã‚‚è¨˜è¼‰ã—ã¾ã—ãŸãŒã€æ”¹ã‚ã¦è©³ç´°ã®èª¬æ˜ã‚’è¨˜è¼‰ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

### Pod

`Pod` ã¨ã¯ã€Kubernetesã®æœ€å°å˜ä½ã®ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚  
è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

- Dockerã‚³ãƒ³ãƒ†ãƒŠã®é›†åˆä½“
- ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚„ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ãƒ«ã‚»ãƒƒãƒˆãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã®æœ€å°å˜ä½
- Podå†…ã®ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ç®¡ç†ã™ã‚‹
- 1ã¤ä»¥ä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å«ã‚€ã“ã¨ãŒã§ãã‚‹
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’å…±æœ‰ã™ã‚‹
- ãƒãƒ¼ãƒ‰é–“ã§ç§»å‹•ã™ã‚‹ã“ã¨ãŒã§ãã‚‹

ä¸‹è¨˜ `pod.yml` ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†:
::: details pod.yml

```yaml:pod.yml
apiVersion: v1
kind: Pod

ã€œçœç•¥ã€œ

spec:
  containers:
  - name: nginx
  image: nginx:1.17.2-alpine
  imaagePullPolicy: never
  command: ["sh", "-c"]
  args:
  - |
    echo ${MESSAGE}
  env: [{name: MESSAGE, value: "Hello World!"}]
    volumeMounts:
    - name: storage
      mountPath: /home/nginx
  volumes:
  - name: storage
    hostPath:
      path: "/data/storage"
      type: Directory
```

:::

ä¸€ä¾‹ã¨ã—ã¦ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã€ä¸»è¦ãª spec ã¯ä»¥ä¸‹ã®é€šã‚Šè¨˜è¼‰ã—ã¾ã™ã€‚

**â€»ä¸‹è¨˜ã¯ã‚ãã¾ã§ä¸€ä¾‹ã§ã‚ã‚Šã€èª¿ã¹ã¦ã¿ãŸçµæœä»–ã«ã‚‚ç¨®é¡ãŒã‚ã‚Šã¾ã—ãŸã€‚**  
**ãã®ä»–ã®ç¨®é¡ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**  
[Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šcontainers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)  
[Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼švolumes](https://kubernetes.io/ja/docs/concepts/storage/volumes/)

**containers**:

- `spec.containers.name`ï¼šã‚³ãƒ³ãƒ†ãƒŠåã‚’æŒ‡å®š
- `spec.containers.image`ï¼šã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®š
- `spec.containers.imagePullPolicy`ï¼šã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®å–å¾—æ–¹æ³•ã‚’æŒ‡å®š
  - `always` ã¯å¸¸ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹
  - `never` ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã—ãªã„
  - `ifNotPresent` ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒãªã„å ´åˆã®ã¿å–å¾—ã™ã‚‹
- `spec.containers.command`ï¼šã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®š
- `spec.containers.args`ï¼šã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã‚’æŒ‡å®š
- `spec.containers.env`ï¼šã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä½¿ç”¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®š
- `spec.containers.volumeMounts`ï¼šã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä½¿ç”¨ã™ã‚‹ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æŒ‡å®š
- `spec.volumes`ï¼šã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä½¿ç”¨ã™ã‚‹ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æŒ‡å®š
- `spec.volumes.name`ï¼šãƒœãƒªãƒ¥ãƒ¼ãƒ åã‚’æŒ‡å®š
- `spec.volumes.mountPath`ï¼šãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ãƒ‘ã‚¹ã‚’æŒ‡å®š

**volumes**:

- `spec.volumes.name`ï¼šãƒœãƒªãƒ¥ãƒ¼ãƒ åã‚’æŒ‡å®š
- `spec.volumes.hostPath`ï¼šãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `spec.volumes.hostPath.path`ï¼šãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `spec.volumes.hostPath.type`ï¼šãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®š

#### æ¼”ç¿’

```txt:ãŠé¡Œç›®
1. ãƒ›ã‚¹ãƒˆã«ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. ä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒã‚¦ãƒ³ãƒˆã—ãŸPodãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
3. ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
```

1.ã¾ãšã¯Kubernetesã®ãƒ›ã‚¹ãƒˆã«ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~# mkdir /data/strage
root@minikube:~# ls /data/
strage
root@minikube:~#
```

2.ä½œæˆã—ãŸ `/data/strage` ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã‚ˆã†ãªPodãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚  
ä½œæˆå¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ã„ã¤ã‚‚é€šã‚Š `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã—ã¾ã™:
::: details tutorial/pod.yml

```yaml:tutorial/pod.yml
apiVersion: v1
kind: Pod
metadata:
  name: sample
spec:
  containers:
  - name: nginx
    image: nginx:1.17.2-alpine
    volumeMounts:
    - name: storage
      mountPath: /home/nginx
  volumes:
  - name: storage
    hostPath:
      path: "/data/storage"
      type: Directory
```

:::

ãƒªã‚½ãƒ¼ã‚¹ä½œæˆå‰ã«ã€1.ã§ä½œæˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ `/home/nginx` ã‹ã‚‰ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã§ãã‚‹ã‹ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚  
å¯¾è±¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `/data/storage` ã«ç§»å‹•ã—ã€ é…ä¸‹ã« `message` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€å†…å®¹ã¯ `Hello World!` ã¨ã—ã¾ã™:

```bash:minikube
root@minikube:~# cd /data/storage/
root@minikube:/data/storage# vi message
root@minikube:/data/storage# cat message
Hello World!
root@minikube:/data/storage#
```

3.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã€ä½œæˆã—ãŸPodã«æ¥ç¶šã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚  
ã¾ãšã¯ `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…ã«æ¥ç¶šã—ã¾ã™:

```bash:minikube
root@minikube:~# cd tutorial/
root@minikube:~/tutorial# kubectl apply -f pod.yml
pod/sample created
root@minikube:~/tutorial# kubectl get pod
NAME     READY   STATUS    RESTARTS   AGE
sample   1/1     Running   0          13s
root@minikube:~/tutorial# kubectl exec -it sample -- sh
/ #
```

`/home/nginx` ã«ãƒã‚¦ãƒ³ãƒˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
/ # cd /home/nginx/
/home/nginx # ls
message
/home/nginx # cat message
HEllo World!
/home/nginx #
```

ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒç¢ºèªã§ãã¾ã—ãŸã€‚  
æ¼”ç¿’ã¨ã—ã¦ã¯å®Œäº†ãªã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦Podã‚’å‰Šé™¤ã—ã¾ã™ã€‚

---

### ReplicaSet

`ReplicaSet` ã¨ã¯ã€Podã®ãƒ¬ãƒ—ãƒªã‚«ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚  
è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

- Podã®ãƒ¬ãƒ—ãƒªã‚«ã‚’ç®¡ç†ã™ã‚‹
- Podã®æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹
- Podã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãƒ»ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã‚’è‡ªå‹•ã§è¡Œã†
- Podã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç›£è¦–ã™ã‚‹
- Podã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¤‰åŒ–ã—ãŸå ´åˆã«ã€æŒ‡å®šã—ãŸæ•°ã®Podã‚’è‡ªå‹•ã§èµ·å‹•ã™ã‚‹

ä¸‹è¨˜ `replicaset.yml` ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†:
:::details replicaset.yml

```yaml:replicaset.yml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web
      env: test
  template:
    metadata:
      name: nginx
      labels:
        app: web
        env: test
    spec:
      containers:
      - name: nginx
        image: nginx:1.17.2-alpine
```

:::

ä¸€ä¾‹ã¨ã—ã¦ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã€ä¸»è¦ãª spec ã¯ä»¥ä¸‹ã®é€šã‚Šè¨˜è¼‰ã—ã¾ã™ã€‚  
**â€»ä¸‹è¨˜ã¯ã‚ãã¾ã§ä¸€ä¾‹ã§ã‚ã‚Šã€èª¿ã¹ã¦ã¿ãŸçµæœä»–ã«ã‚‚ç¨®é¡ãŒã‚ã‚Šã¾ã—ãŸã€‚**  
**ãã®ä»–ã®ç¨®é¡ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**  
[Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šReplicaSets](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/)

**replicas**:

- `spec.replicas`ï¼šPodã‚’è¤‡è£½ã™ã‚‹æ•°ã‚’æŒ‡å®š

**selector**:

- `spec.selector`ï¼šPodã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®š

**template**:

- `spec.template`ï¼šPodã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®š
- `spec.template.metadata`ï¼šPodã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®š
- `spec.template.metadata.name`ï¼šPodã®åå‰ã‚’æŒ‡å®š
- `spec.template.metadata.labels`ï¼šPodã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®š
- `spec.template.spec`ï¼šPodã®ä»•æ§˜ã‚’æŒ‡å®š
- `spec.template.spec.containers`ï¼šPodå†…ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’æŒ‡å®š
- `spec.template.spec.containers.name`ï¼šã‚³ãƒ³ãƒ†ãƒŠåã‚’æŒ‡å®š
- `spec.template.spec.containers.image`ï¼šã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®š

#### æ¼”ç¿’

```txt:ãŠé¡Œç›®
1. ReplicaSetãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
3. æ‰‹å‹•ã§ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ(æ§‹ç¯‰ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã®å°æ•°ã‚’å¢—ã‚„ã™)
```

1.ã¾ãšã¯ `tutorial` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€ReplicaSetãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:
::: details tutorial/replicaset.yml

```yaml:tutorial/replicaset.yml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web
      env: test
  template:
    metadata:
      name: nginx
      labels:
        app: web
        env: test
    spec:
      containers:
      - name: nginx
        image: nginx:1.17.2-alpine
```

:::

2.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f replicaset.yml
replicaset.apps/nginx created
root@minikube:~/tutorial#
```

å‡ºåŠ›çµæœã‹ã‚‰ã€3ã¤ã®PodãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚  
ã¾ãŸã€ `kubectl get all` ã‚³ãƒãƒ³ãƒ‰ã§ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl get all
NAME              READY   STATUS    RESTARTS   AGE
pod/nginx-mp4bl   1/1     Running   0          60m
pod/nginx-rnfsx   1/1     Running   0          60m
pod/nginx-wl77v   1/1     Running   0          60m

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   6d2h

NAME                    DESIRED   CURRENT   READY   AGE
replicaset.apps/nginx   3         3         3       60m
root@minikube:~/tutorial#
```

3.æ‰‹å‹•ã§ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚  
æ–¹æ³•ã¨ã—ã¦ã¯ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã€ `replicas` ã®å€¤ã‚’å¤‰æ›´ã—ã¾ã™ã€‚
ã“ã“ã§ã¯ã€ `replicas` ã®å€¤ã‚’ `5` ã«å¤‰æ›´ã—ã¾ã™:
::: details tutorial/replicaset.yml

```yaml:tutorial/replicaset.yml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
spec:
  replicas: 5 # 3 -> 5 ã«å¤‰æ›´
  selector:
    matchLabels:
      app: web
      env: test
  template:
    metadata:
      name: nginx
      labels:
        app: web
        env: test
    spec:
      containers:
      - name: nginx
        image: nginx:1.17.2-alpine
```

:::

å¤‰æ›´ã—ãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é©ç”¨ã—ã€ãƒªã‚½ãƒ¼ã‚¹ã‚’å†åº¦ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f replicaset.yml
replicaset.apps/nginx configured
root@minikube:~/tutorial# kubectl get all
NAME              READY   STATUS    RESTARTS   AGE
pod/nginx-9n9bs   1/1     Running   0          13s
pod/nginx-dlbw2   1/1     Running   0          13s
pod/nginx-mp4bl   1/1     Running   0          64m
pod/nginx-rnfsx   1/1     Running   0          64m
pod/nginx-wl77v   1/1     Running   0          64m

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   6d2h

NAME                    DESIRED   CURRENT   READY   AGE
replicaset.apps/nginx   5         5         5       64m
root@minikube:~/tutorial#
```

å‡ºåŠ›çµæœã‚ˆã‚Šã€PodãŒ5ã¤ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚  
ã“ã®ã‚ˆã†ã«ã€ReplicaSetã‚’ä½¿ã†ã“ã¨ã§ã€Podã®æ•°ã‚’ç°¡å˜ã«å¢—æ¸›ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
æ¼”ç¿’ã¨ã—ã¦ã¯å®Œäº†ãªã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦Podã‚’å‰Šé™¤ã—ã¾ã™ã€‚

---

### Deployment

`Deployment` ã¨ã¯ã€ ReplicaSet ã®é›†åˆä½“ã§ã€ãã‚Œã‚‰ã®ä¸–ä»£ç®¡ç†ãŒã§ãã‚‹ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚  
è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

- Podã®ãƒ¬ãƒ—ãƒªã‚«ã‚’ç®¡ç†ã™ã‚‹
- Podã®æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹
- Podã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãƒ»ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã‚’è‡ªå‹•ã§è¡Œã†
- Podã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç›£è¦–ã™ã‚‹
- Podã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¤‰åŒ–ã—ãŸå ´åˆã«ã€æŒ‡å®šã—ãŸæ•°ã®Podã‚’è‡ªå‹•ã§èµ·å‹•ã™ã‚‹

ä¸‹è¨˜ `deployment.yml` ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†:
:::details deployment.yml

```yaml:deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  annotations:
    kubernetes.io/change-cause: "First release."
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web
      env: study
  revisionHistoryLimit: 14
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  template:
    metadata:
      name: nginx
      labels:
        app: web
        env: study
    spec:
      containers:
      - name: nginx
        image: nginx:1.17.2-alpine

```

:::

ä¸€ä¾‹ã¨ã—ã¦ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã€ä¸»è¦ãª spec ã¯ä»¥ä¸‹ã®é€šã‚Šè¨˜è¼‰ã—ã¾ã™ã€‚  
**â€»ä¸‹è¨˜ã¯ã‚ãã¾ã§ä¸€ä¾‹ã§ã‚ã‚Šã€èª¿ã¹ã¦ã¿ãŸçµæœä»–ã«ã‚‚ç¨®é¡ãŒã‚ã‚Šã¾ã—ãŸã€‚**  
**ãã®ä»–ã®ç¨®é¡ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**  
[Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šDeployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)

**replicas**:

- `spec.replicas`ï¼šPodã‚’è¤‡è£½ã™ã‚‹æ•°ã‚’æŒ‡å®š

**selector**:

- `spec.selector`ï¼šPodã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®š
- `spec.selector.matchLabels`ï¼šPodã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®š
- `spec.selector.matchLabels.app`ï¼šPodã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®š
- `spec.selector.matchLabels.env`ï¼šPodã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®š

**revisionHistoryLimit**:

- `spec.revisionHistoryLimit`ï¼šDeploymentã®å±¥æ­´ã‚’ä¿æŒã™ã‚‹æ•°ã‚’æŒ‡å®š(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯**10**)

**strategy**:
â€»**Kubernetes v1.15 ä»¥é™ã§ã¯ RollingUpdate ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ã«ãªã‚Šã¾ã—ãŸã€‚

- `spec.strategy`ï¼šã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®æ–¹æ³•ã‚’æŒ‡å®š
- `spec.strategy.type`ï¼šã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®š
- `spec.strategy.rollingUpdate`ï¼šã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®æ–¹æ³•ã‚’æŒ‡å®š
- `spec.strategy.rollingUpdate.maxSurge`ï¼šã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆæ™‚ã«ä½œæˆã™ã‚‹Podã®æ•°ã‚’æŒ‡å®š
  (**ãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’è¶…ãˆã¦ã‚ˆã„Podæ•°**)
- `spec.strategy.rollingUpdate.maxUnavailable`ï¼šã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³æ™‚ã«å‰Šé™¤ã™ã‚‹Podã®æ•°ã‚’æŒ‡å®š
  (**ä¸€åº¦ã«æ¶ˆå¤±ã—ã¦ã‚ˆã„Podæ•°**)

ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:

```bash:minikube
kubectl rollout history [TYPE/NAME] --to-revision=N
```

ãƒ»å¼•æ•°
`TYPE`:ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡  
`NAME`:ãƒªã‚½ãƒ¼ã‚¹å  
--to-revision:ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ã®ç•ªå·(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯0)

**template**:

- `spec.template.metadata.labels`ï¼šPodã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®š
- `spec.template.spec.containers.name`ï¼šã‚³ãƒ³ãƒ†ãƒŠåã‚’æŒ‡å®š
- `spec.template.spec.containers.image`ï¼šã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®š

#### æ¼”ç¿’

```txt:ãŠé¡Œç›®
1. Deploymentãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
3. ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ç¢ºèª
4. Deploymentä¿®æ­£
5. ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ç¢ºèª
6. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
```

1. Deploymentãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:

::: details tutorial/deployment.yml

```yaml:tutorial/deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web
      env: study
  revisionHistoryLimit: 14
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  template:
    metadata:
      name: nginx
      labels:
        app: web
        env: study
    spec:
      containers:
      - name: nginx
        image: nginx:1.17.2-alpine
```

:::

2.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f deployment.yml
deployment.apps/nginx created
root@minikube:~/tutorial# kubectl get all
NAME                         READY   STATUS    RESTARTS   AGE
pod/nginx-7f5db5465d-s9tf9   1/1     Running   0          17s
pod/nginx-7f5db5465d-xhfzl   1/1     Running   0          17s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   6d17h

NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx   2/2     2            2           17s

NAME                               DESIRED   CURRENT   READY   AGE
replicaset.apps/nginx-7f5db5465d   2         2         2       17s
root@minikube:~/tutorial#
```

5.ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl rollout history deployment/nginx
deployment.apps/nginx
REVISION  CHANGE-CAUSE
1         <none>

root@minikube:~/tutorial#
```

å®Ÿè¡Œçµæœã‹ã‚‰ã€ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ã¯1ã¤ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚  
å‡ºåŠ›çµæœã® `CHANGE-CAUSE` ã®éƒ¨åˆ†ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç©ºã«ãªã£ã¦ã„ã¾ã™ã€‚

4.Deploymentä¿®æ­£ã—ã¾ã™ã€‚
ã“ã¡ã‚‰ã‚’æ›´æ–°ã™ã‚‹ã«ã¯ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã® `annotations` ã« `kubernetes.io/change-cause` ã‚’è¿½åŠ ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨˜è¼‰ã—ã¾ã™:
:::details tutorial/deployment.yml

```yaml:tutorial/deployment.yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  annotations: # è¿½åŠ 
    kubernetes.io/change-cause: "Update nginx" # è¿½åŠ 
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web
      env: study
  revisionHistoryLimit: 14
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  template:
    metadata:
      name: nginx
      labels:
        app: web
        env: study
    spec:
      containers:
      - name: nginx
        image: nginx:1.17.3-alpine # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰æ›´

```

:::
å†åº¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ã€ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f deployment.yml
deployment.apps/nginx configured
root@minikube:~/tutorial# kubectl rollout history deploy/nginx
deployment.apps/nginx
REVISION  CHANGE-CAUSE
1         <none>
2         Update nginx

root@minikube:~/tutorial#
```

annotations ã«è¨˜è¼‰ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã€ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚  
ã—ã‹ã—ã€nginxã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒUpã—ãŸå±¥æ­´ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚  
ã“ã‚Œã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆå±¥æ­´ã«ãƒªã‚½ãƒ¼ã‚¹ã®å¤‰æ›´å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã§ã™ã€‚  
ãã‚Œã«å¯¾ã—ã¦ã¯ã€ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl rollout history deploy/nginx --revision=2
deployment.apps/nginx with revision #2
Pod Template:
  Labels:       app=web
        env=study
        pod-template-hash=9fc9b8565
  Annotations:  kubernetes.io/change-cause: Update nginx
  Containers:
   nginx:
    Image:      nginx:1.17.3-alpine
    Port:       <none>
    Host Port:  <none>
    Environment:        <none>
    Mounts:     <none>
  Volumes:      <none>
  Node-Selectors:       <none>
  Tolerations:  <none>

root@minikube:~/tutorial#
```

`kubectl rollout history` ã‚³ãƒãƒ³ãƒ‰ã®åŸºæœ¬å‡ºåŠ›ã§ã¯ã€**change-cause ã®ã¿ãŒè¡¨ç¤º**ã•ã‚Œã¾ã™ã€‚  
å…·ä½“çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ã®è©³ç´°æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€**--revision ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ç‰¹å®šã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

6.ç›´å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl rollout undo deployment/nginx
deployment.apps/nginx rolled back
root@minikube:~/tutorial# kubectl rollout history deploy/nginx
deployment.apps/nginx
REVISION  CHANGE-CAUSE
2         Update nginx
3         <none>

root@minikube:~/tutorial#
```

REVISION 3 ãŒè¿½åŠ ã•ã‚Œã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚  
ã“ã®ã‚ˆã†ã«ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ `kubectl rollout undo` ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ã€‚  
æ¼”ç¿’ã¨ã—ã¦ã¯å®Œäº†ãªã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦Podã‚’å‰Šé™¤ã—ã¾ã™ã€‚

---

### Service

`Service` ã¯ã€å¤–éƒ¨å…¬é–‹ã€å†…éƒ¨é€šä¿¡ã€åå‰è§£æ±ºãªã©ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚  
ç¨®åˆ¥ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã®ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚

- **ClusterIP**
  - ã‚¯ãƒ©ã‚¹ã‚¿ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¬é–‹
  - åå‰è¨­å®šã§Podã¸åˆ°é”ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- **NodePort**
  ClusterIP ã«åŠ ãˆã€Node ã®ãƒãƒ¼ãƒˆã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦å—ã‘ä»˜ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
- **LoadBalancer**
  NodePort ã«åŠ ãˆã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‚’åˆ©ç”¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’å…¬é–‹ã™ã‚‹
- **ExternalName**
  å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã«æ¥ç¶š

ä¸‹è¨˜ `service.yml` ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†:

::: details service.yml

```yaml:service.yml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: web
    env: study
spec:
  containers:
  - name: nginx
    image: nginx:1.17.2-alpine

---
apiVersion: v1
kind: Service
metadata:
  name: web-svc
spec:
  type: ClusterIP
  clusterIP: 10.101.10.100
  selector:
    app: web
    env: study
  ports:
  - port: 80
    targetPort: 80
    nodePort: 30000
```

:::

ä¸€ä¾‹ã¨ã—ã¦ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã€ä¸»è¦ãª spec ã¯ä»¥ä¸‹ã®é€šã‚Šè¨˜è¼‰ã—ã¾ã™ã€‚  
**â€»ä¸‹è¨˜ã¯ã‚ãã¾ã§ä¸€ä¾‹ã§ã‚ã‚Šã€èª¿ã¹ã¦ã¿ãŸçµæœä»–ã«ã‚‚ç¨®é¡ãŒã‚ã‚Šã¾ã—ãŸã€‚**  
**ãã®ä»–ã®ç¨®é¡ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**  
[Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:Service](https://kubernetes.io/docs/concepts/services-networking/service/)

**containers**:

- `spec.containers`: ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®š
  - `spec.containers.image`: ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸
- `spec.type`: ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡
- `spec.clusterIP`: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼IP
  - `spec.clusterIP` ã‚’æŒ‡å®šã—ãªã„å ´åˆã€è‡ªå‹•çš„ã«ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼IPãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
  - `spec.clusterIP` ã‚’æŒ‡å®šã—ãŸå ´åˆã€æŒ‡å®šã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼IPãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
- `spec.selector`: ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ©ãƒ™ãƒ«
- `spec.ports`: ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒãƒ¼ãƒˆ
  - `spec.ports.port`: ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒãƒ¼ãƒˆ
  - `spec.ports.targetPort`: ã‚³ãƒ³ãƒ†ãƒŠè»¢é€å…ˆãƒãƒ¼ãƒˆ
  - `spec.ports.nodePort`: Nodeã®ãƒãƒ¼ãƒˆ

#### æ¼”ç¿’

```txt:ãŠé¡Œç›®
1.NodePortã®Serviceãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2.ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
3.ãƒ–ãƒ©ã‚¦ã‚¶ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å‹•ä½œç¢ºèª
```

1.NodePortã®Serviceãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:
::: details tutorial/service.yml

```yaml:tutorial/service.yml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: web
    env: study
spec:
  containers:
  - name: nginx
    image: nginx:1.17.2-alpine
    ports:
    - containerPort: 80

---
apiVersion: v1
kind: Service
metadata:
  name: web-svc
spec:
  type: NodePort
  selector:
    app: web
    env: study
  ports:
  - port: 80
    targetPort: 80
    nodePort: 30000
```

:::

2.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f service.yml
pod/nginx created
service/web-svc created
root@minikube:~/tutorial#
```

```bash:minikube
root@minikube:~/tutorial# kubectl get all
NAME        READY   STATUS    RESTARTS   AGE
pod/nginx   1/1     Running   0          11s

NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/kubernetes   ClusterIP   10.96.0.1       <none>        443/TCP        6d21h
service/web-svc      NodePort    10.102.57.173   <none>        80:30000/TCP   11s
root@minikube:~/tutorial#
```

`web-svc` ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚

3.ãƒ–ãƒ©ã‚¦ã‚¶ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å‹•ä½œç¢ºèªã—ã¾ã™ã€‚
å‰æ®µã§ä½œæˆã—ãŸ service.yml ã«è¨˜è¼‰ã®é€šã‚Šã€80ç•ªãƒãƒ¼ãƒˆã‹ã‚‰ NodePort ã®30000ç•ªãƒãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚  
ã‚„ã‚Šæ–¹ã¨ã—ã¦ã¯ã€ä»®æƒ³ãƒã‚·ãƒ³ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚ã¨ã« `:30000` ã‚’ä»˜ä¸ã—ã¾ã™ã€‚  
è‡ªç«¯æœ«ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ã€ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»®æƒ³ãƒã‚·ãƒ³ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

```bash:terminal
minikube ip
192.168.49.2
```

ä¸Šã®ã‚³ãƒãƒ³ãƒ‰çµæœã‹ã‚‰ã€`192.168.49.2:30000` ã¨ãªã‚Šã¾ã™ã€‚

![access-loop](/images/kubernetes-tutorial/access-loop.png)

ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚ˆã†ã§ã™ã®ã§ã€åŸå› ã®ç¢ºèªã‚’ã—ã¾ã™ã€‚  
ç¢ºå®Ÿãªæ–¹æ³•ã¨ã—ã¦ã€ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã®ç¢ºèªã‚’è‡ªç«¯æœ«ã‹ã‚‰å®Ÿæ–½ã—ã¾ã™:

```bash:terminal
kubectl port-forward service/web-svc 8080:80
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ <http://localhost:8080> ã«ã‚¢ã‚¯ã‚»ã‚¹ã€‚

![port-forward](/images/kubernetes-tutorial/port-forward.png)

ã²ã¨ã¾ãšè¡¨ç¤ºã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

æ¬¡ã«ã€ `minikube service web-avc` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™:

```bash:terminal
minikube service web-svc

|-----------|---------|-------------|---------------------------|
| NAMESPACE |  NAME   | TARGET PORT |            URL            |
|-----------|---------|-------------|---------------------------|
| default   | web-svc |          80 | http://192.168.49.2:30000 |
|-----------|---------|-------------|---------------------------|
ğŸƒ  web-svc ã‚µãƒ¼ãƒ“ã‚¹ç”¨ã®ãƒˆãƒ³ãƒãƒ«ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚
|-----------|---------|-------------|------------------------|
| NAMESPACE |  NAME   | TARGET PORT |          URL           |
|-----------|---------|-------------|------------------------|
| default   | web-svc |             | http://127.0.0.1:51389 |
|-----------|---------|-------------|------------------------|
ğŸ‰  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ default/web-svc ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ã„ã¦ã„ã¾ã™...
â—  Docker ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ darwin ä¸Šã§ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€å®Ÿè¡Œã™ã‚‹ã«ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```

ã“ã‚Œã ã¨ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã§ã™ãŒã€è»¢é€å…ˆã®ãƒãƒ¼ãƒˆç•ªå·ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™:

::: details 30000ãƒãƒ¼ãƒˆèª¿æŸ»

```bash:terminal
sudo lsof -i -P -n | grep LISTEN

ControlCe   598         wan0ri    8u  IPv4  0x3afdecce503bcbc      0t0    TCP *:7000 (LISTEN)
ControlCe   598         wan0ri    9u  IPv6 0x99f4c63a72bbee16      0t0    TCP *:7000 (LISTEN)
ControlCe   598         wan0ri   10u  IPv4 0xff7d2e786c2f4154      0t0    TCP *:5000 (LISTEN)
ControlCe   598         wan0ri   11u  IPv6 0x7b0ab8d631810a8f      0t0    TCP *:5000 (LISTEN)
rapportd    647         wan0ri    8u  IPv4 0xe787816e3568c0c0      0t0    TCP *:49152 (LISTEN)
rapportd    647         wan0ri    9u  IPv6 0xe16e33c168b68887      0t0    TCP *:49152 (LISTEN)
Raycast     683         wan0ri   42u  IPv4 0x66633fceb00a43dc      0t0    TCP 127.0.0.1:7265 (LISTEN)
logioptio   739         wan0ri   40u  IPv4 0xf6c87394e39caa96      0t0    TCP *:59869 (LISTEN)
Stream      748         wan0ri   21u  IPv4 0x1584f5c902f4fc3e      0t0    TCP 127.0.0.1:28196 (LISTEN)
Stream      748         wan0ri   83u  IPv6 0x2029c113012954bd      0t0    TCP *:28198 (LISTEN)
Google      825         wan0ri   43u  IPv6 0x785b2916e715207f      0t0    TCP [::1]:7679 (LISTEN)
Cursor     1834         wan0ri   28u  IPv4  0xf1e43c229680aa6      0t0    TCP 127.0.0.1:49656 (LISTEN)
Cursor     1836         wan0ri  101u  IPv6 0x5396a379897848a3      0t0    TCP *:49900 (LISTEN)
com.docke  3641         wan0ri  142u  IPv4 0xd0d37d36cd1fe794      0t0    TCP 127.0.0.1:49647 (LISTEN)
com.docke  3641         wan0ri  164u  IPv4 0x7beb3108c1e8146b      0t0    TCP 127.0.0.1:49648 (LISTEN)
com.docke  3641         wan0ri  165u  IPv4 0xa7501b375430a281      0t0    TCP 127.0.0.1:49649 (LISTEN)
com.docke  3641         wan0ri  166u  IPv4 0x4422138d50fce971      0t0    TCP 127.0.0.1:49650 (LISTEN)
com.docke  3641         wan0ri  175u  IPv4 0xc75cc9a524e61117      0t0    TCP 127.0.0.1:49651 (LISTEN)
com.docke  3641         wan0ri  186u  IPv4 0xcdfa1e7b642cea8b      0t0    TCP 127.0.0.1:6443 (LISTEN)
ssh        4848         wan0ri    5u  IPv6 0xdb9cf91b4ecd09a4      0t0    TCP [::1]:50720 (LISTEN)
ssh        4848         wan0ri    6u  IPv4 0x281c149607849139      0t0    TCP 127.0.0.1:50720 (LISTEN)
Cursor     5389         wan0ri   35u  IPv4 0x8a7d5f1734985fb2      0t0    TCP 127.0.0.1:46329 (LISTEN)
node       5657         wan0ri   14u  IPv6 0x2889e17cd884fa2c      0t0    TCP *:49901 (LISTEN)
kubectl    6078         wan0ri    8u  IPv4 0xa3c01d69d3e2afda      0t0    TCP 127.0.0.1:8080 (LISTEN)
kubectl    6078         wan0ri    9u  IPv6 0x1183030740956343      0t0    TCP [::1]:8080 (LISTEN)
ssh        9893         wan0ri    5u  IPv6 0x6a940d1f8ec2aa14      0t0    TCP [::1]:51731 (LISTEN)
ssh        9893         wan0ri    6u  IPv4 0x857aab088d9057f4      0t0    TCP 127.0.0.1:51731 (LISTEN)

sudo lsof -i :30000

netstat -an | grep LISTEN

tcp4       0      0  127.0.0.1.51731        *.*                    LISTEN
tcp6       0      0  ::1.51731              *.*                    LISTEN
tcp6       0      0  ::1.8080               *.*                    LISTEN
tcp4       0      0  127.0.0.1.8080         *.*                    LISTEN
tcp4       0      0  127.0.0.1.50720        *.*                    LISTEN
tcp6       0      0  ::1.50720              *.*                    LISTEN
tcp4       0      0  127.0.0.1.49656        *.*                    LISTEN
tcp46      0      0  *.28198                *.*                    LISTEN
tcp46      0      0  *.49901                *.*                    LISTEN
tcp46      0      0  *.49900                *.*                    LISTEN
tcp4       0      0  127.0.0.1.46329        *.*                    LISTEN
tcp4       0      0  127.0.0.1.49651        *.*                    LISTEN
tcp4       0      0  127.0.0.1.49650        *.*                    LISTEN
tcp4       0      0  127.0.0.1.49649        *.*                    LISTEN
tcp4       0      0  127.0.0.1.49648        *.*                    LISTEN
tcp4       0      0  127.0.0.1.49647        *.*                    LISTEN
tcp4       0      0  127.0.0.1.6443         *.*                    LISTEN
tcp4       0      0  *.59869                *.*                    LISTEN
tcp4       0      0  127.0.0.1.28196        *.*                    LISTEN
tcp6       0      0  ::1.7679               *.*                    LISTEN
tcp4       0      0  127.0.0.1.7265         *.*                    LISTEN
tcp6       0      0  *.49152                *.*                    LISTEN
tcp4       0      0  *.49152                *.*                    LISTEN
tcp6       0      0  *.5000                 *.*                    LISTEN
tcp4       0      0  *.5000                 *.*                    LISTEN
tcp6       0      0  *.7000                 *.*                    LISTEN
tcp4       0      0  *.7000                 *.*                    LISTEN

sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
Firewall is enabled. (State = 1)

sudo /usr/libexec/ApplicationFirewall/socketfilterfw --listapps
Total number of apps = 15
1 : /usr/libexec/dhcp6d
             (Allow incoming connections)
2 : /Library/Application Support/Logitech.localized/LogiOptionsPlus/logioptionsplus_agent.app/Contents/MacOS/logioptionsplus_agent
             (Allow incoming connections)
3 : /System/Library/CoreServices/UniversalControl.app/Contents/MacOS/UniversalControl
             (Allow incoming connections)
4 : /System/Library/CoreServices/ControlCenter.app/Contents/MacOS/ControlCenter
             (Allow incoming connections)
5 : /System/Library/PrivateFrameworks/ReplicatorCore.framework/Support/replicatord
             (Allow incoming connections)
6 : /Applications/Google Chrome.app
             (Allow incoming connections)
7 : /Applications/Spotify.app
             (Allow incoming connections)
8 : /usr/libexec/rapportd
             (Allow incoming connections)
9 : /usr/libexec/remoted
             (Allow incoming connections)
10 : /usr/bin/python3
             (Allow incoming connections)
11 : /usr/bin/ruby
             (Allow incoming connections)
12 : /usr/sbin/cupsd
             (Allow incoming connections)
13 : /usr/libexec/sharingd
             (Allow incoming connections)
14 : /usr/libexec/sshd-keygen-wrapper
             (Allow incoming connections)
15 : /usr/sbin/smbd
             (Allow incoming connections)
```

:::

ãã‚‚ãã‚‚ã€30000ãƒãƒ¼ãƒˆã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªãã€**ãã®ãƒãƒ¼ãƒˆã§ãƒªãƒƒã‚¹ãƒ³ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ãªã„**ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

- âœ… ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¯æœ‰åŠ¹ã ãŒã€30000ç•ªãƒãƒ¼ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ãªã„
- âœ… 8080ç•ªãƒãƒ¼ãƒˆï¼ˆkubectl port-forwardï¼‰ã¯æ­£å¸¸ã«ãƒªãƒƒã‚¹ãƒ³ä¸­
- âŒ 30000ç•ªãƒãƒ¼ãƒˆã§ãƒªãƒƒã‚¹ãƒ³ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ãªã„

ã“ã®ã“ã¨ã‹ã‚‰ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§å‰²ã‚Šå½“ã¦ã¦ã„ã‚‹30000ãƒãƒ¼ãƒˆã‚’ä¿®æ­£ã—ã€å‹•çš„ã«ãƒãƒ¼ãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™:

::: details ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£

```yaml:tutorial/service.yml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: web
    env: study
spec:
  containers:
  - name: nginx
    image: nginx:1.17.2-alpine
    ports:
    - containerPort: 80

---
apiVersion: v1
kind: Service
metadata:
  name: web-svc
spec:
  type: NodePort
  selector:
    app: web
    env: study
  ports:
  - port: 80
    targetPort: 80
    # nodePort: 30000 = è‡ªå‹•å‰²ã‚Šå½“ã¦ã®ãŸã‚ã€æ˜ç¤ºçš„ã«æŒ‡å®šã—ãªã„
```

:::

å†åº¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã€å®Ÿéš›ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒãƒ¼ãƒˆã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f service.yml
pod/nginx created
service/web-svc created
root@minikube:~/tutorial# kubectl get service web-svc
NAME      TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
web-svc   NodePort   10.105.161.23   <none>        80:30410/TCP   9s
root@minikube:~/tutorial#
```

æ¬¡ã«ã€è‡ªç«¯æœ«ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã—ã¦ã¿ã¾ã™:

```bash:terminal
minikube service web-svc
|-----------|---------|-------------|---------------------------|
| NAMESPACE |  NAME   | TARGET PORT |            URL            |
|-----------|---------|-------------|---------------------------|
| default   | web-svc |          80 | http://192.168.49.2:30410 |
|-----------|---------|-------------|---------------------------|
ğŸƒ  web-svc ã‚µãƒ¼ãƒ“ã‚¹ç”¨ã®ãƒˆãƒ³ãƒãƒ«ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚
|-----------|---------|-------------|------------------------|
| NAMESPACE |  NAME   | TARGET PORT |          URL           |
|-----------|---------|-------------|------------------------|
| default   | web-svc |             | http://127.0.0.1:53016 |
|-----------|---------|-------------|------------------------|
ğŸ‰  ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ default/web-svc ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ã„ã¦ã„ã¾ã™...
â—  Docker ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ darwin ä¸Šã§ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€å®Ÿè¡Œã™ã‚‹ã«ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```

![access-retry](/images/kubernetes-tutorial/access-retry.png)

ç„¡äº‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã—ãŸï¼ğŸ‰

æ¼”ç¿’ã¨ã—ã¦ã¯å®Œäº†ãªã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦Podã‚’å‰Šé™¤ã—ã¾ã™ã€‚

### ConfigMap

Kubernetesã§ã¯ã€è¨­å®šæƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦ConfigMapãŒã‚ã‚Šã¾ã™ã€‚  
ConfigMapã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

- è¨­å®šæƒ…å ±ã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰åˆ‡ã‚Šé›¢ã—ã€ã‚ˆã‚ŠæŸ”è»Ÿãªç®¡ç†ãŒå¯èƒ½ã«ãªã‚‹
- è¨­å®šæƒ…å ±ã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰åˆ‡ã‚Šé›¢ã™ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å†ãƒ“ãƒ«ãƒ‰ã‚„å†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å¿…è¦ã¨ã›ãšã«è¨­å®šæƒ…å ±ã‚’å¤‰æ›´ã§ãã‚‹

ä¸‹è¨˜ `configmap.yml` ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†:

::: details configmap.yml

```yaml:configmap.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sample-config
  namespace: default
data:
  sample.cfg: |
    user: taro.tanaka
  type: "application"

---
apiVersion: v1
kind: Pod
metadata:
  name: sample
  namespace: default
spec:
  containers:
  - name: sample
    image: nginx:1.17.2-alpine
    env:
    - name: TYPE
      valueFrom:
        configMapKeyRef:
          name: sample-config
          key: type
    volumeMounts:
    - name: config-storage
      mountPath: /home/nginx
  volumes:
  - name: config-storage
    configMap:
      name: sample-config
      items:
      - key: sample.cfg
        path: sample.cfg
```

:::

ä¸€ä¾‹ã¨ã—ã¦ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã¯ã€ã“ã‚Œã¾ã§ã¯ spec ã«ç€ç›®ã—ã¦ã„ã¾ã—ãŸãŒ ConfigMap ã§ã¯ **data ã«ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼ã§ä¿å­˜**ã—ã¾ã™ã€‚  
**â€»ä¸‹è¨˜ã¯ã‚ãã¾ã§ä¸€ä¾‹ã§ã‚ã‚Šã€èª¿ã¹ã¦ã¿ãŸçµæœä»–ã«ã‚‚ç¨®é¡ãŒã‚ã‚Šã¾ã—ãŸã€‚**  
**ãã®ä»–ã®ç¨®é¡ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**  
[Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap/)

**data**:

- `data`: è¨­å®šæƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿
- `data.sample.cfg`: ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®è¨­å®šãƒ‡ãƒ¼ã‚¿ï¼ˆè¤‡æ•°è¡Œã®ãƒ†ã‚­ã‚¹ãƒˆï¼‰
- `data.type`: ã‚­ãƒ¼ãƒ»ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®è¨­å®šãƒ‡ãƒ¼ã‚¿ï¼ˆå˜ä¸€ã®å€¤ï¼‰

**containers**:

- `spec.containers.env.valueForm`: å€¤ã®å–å¾—å…ƒã‚’æŒ‡å®š
- `spec.containers.env.valueFrom.configMapKeyRef.name`: ConfigMapã‹ã‚‰å€¤ã‚’å‚ç…§
- `spec.containers.env.valueFrom.configMapKeyRef.key`: ConfigMapã®ã‚­ãƒ¼ã‚’æŒ‡å®š

ãƒªã‚½ãƒ¼ã‚¹ã®åˆ©ç”¨æ–¹æ³•ã¯ã€2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚

| åˆ©ç”¨æ–¹æ³•               | ãƒã‚¤ãƒ³ãƒˆ                                            |
| ---------------------- | --------------------------------------------------- |
| ãƒ¯ãƒ¼ã‚¯ãƒ­ç’°å¢ƒå¤‰æ•°ã¸æ¸¡ã™ | spec.containers.env.valueForm ã« ConfigMap ã‚’æŒ‡å®š   |
| ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆ | spec.volumes ã¨ spec.containers.volumeMounts ã«æŒ‡å®š |

#### æ¼”ç¿’

```txt:ãŠé¡Œç›®
1.ConfigMap ã¨ Pod ã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
3.Pod ã«å…¥ã£ã¦ ConfigMap ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
```

1. ConfigMap ã¨ Pod ã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:

::: details tutorial/configmap.yml

```yaml:tutorial/configmap.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: sample-config
  namespace: default
data:
  sample.cfg: |
    user: taro.tanaka
  type: "application"

---
apiVersion: v1
kind: Pod
metadata:
  name: sample
  namespace: default
spec:
  containers:
  - name: sample
    image: nginx:1.17.2-alpine
    env:
    - name: TYPE
      valueFrom:
        configMapKeyRef:
          name: sample-config
          key: type
    volumeMounts:
    - name: config-storage
      mountPath: /home/nginx
  volumes:
  - name: config-storage
    configMap:
      name: sample-config
      items:
      - key: sample.cfg
        path: sample.cfg
```

:::

2.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f configmap.yml
configmap/sample-config created
pod/sample created
root@minikube:~/tutorial#
```

3.ãƒã‚¦ãƒ³ãƒˆå…ˆã® `/home/nginx` ã« `sample.cfg` ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl exec -it sample -- shs
/ # ls /home/nginx/
sample.cfg
/ # cat /home/nginx/sample.cfg
user: taro.tanaka
/ #
```

`sample.cfg` ã®å­˜åœ¨ã‚’ç¢ºèªã§ãã€ã‹ã¤ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚‚ç¢ºèªã§ãã¾ã—ãŸã€‚  
ã“ã®ã‚ˆã†ã«ã€ConfigMap ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€è¨­å®šæƒ…å ±ã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰åˆ‡ã‚Šé›¢ã—ã€ã‚ˆã‚ŠæŸ”è»Ÿãªç®¡ç†ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚  
æ¼”ç¿’ã¨ã—ã¦ã¯å®Œäº†ãªã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦Podã‚’å‰Šé™¤ã—ã¾ã™ã€‚

---

### Secret

Kubernetesä¸Šã§æ©Ÿå¯†æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦SecretãŒã‚ã‚Šã¾ã™ã€‚
Secretã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

- æ©Ÿå¯†æƒ…å ±ã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰åˆ‡ã‚Šé›¢ã—ã€ã‚ˆã‚ŠæŸ”è»Ÿãªç®¡ç†ãŒå¯èƒ½ã«ãªã‚‹
- æ©Ÿå¯†æƒ…å ±ã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰åˆ‡ã‚Šé›¢ã™ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å†ãƒ“ãƒ«ãƒ‰ã‚„å†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å¿…è¦ã¨ã›ãšã«æ©Ÿå¯†æƒ…å ±ã‚’å¤‰æ›´ã§ãã‚‹
- ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã«æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚ã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹
- Kubernetesã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§æ©Ÿå¯†æƒ…å ±ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã‚‹
- æ©Ÿå¯†æƒ…å ±ã‚’æš—å·åŒ–ã—ã¦ä¿å­˜ã™ã‚‹ã“ã¨ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹

ä¸‹è¨˜ `secret.yml` ã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†:
::: details secret.yml

```yaml:secret.yml
apiVersion: v1
kind: Secret
metadata:
  name: sample-secret
data:
  message: SGVsbG8gV29ybGQgIQ==     # echo -n 'Hello World !' | base64
  keyfile: WU9VUi1TRUNSRVQtS0VZ     # cat ./keyfile | base64

---
apiVersion: v1
kind: Pod
metadata:
  name: sample
  namespace: default
spec:
  containers:
  - name: sample
    image: nginx:1.17.2-alpine
    env:
    - name: MESSAGE
      valueFrom:
        secretKeyRef:
          name: sample-secret
          key: message
    volumeMounts:
    - name: secret-storage
      mountPath: /home/nginx
  volumes:
  - name: secret-storage
    secret:
      secretName: sample-secret
      items:
      - key: keyfile
        path: keyfile
```

:::

ä¸€ä¾‹ã¨ã—ã¦ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã¯Secretã§ã¯ **data ã«ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼ã§ä¿å­˜**ã—ã¾ã™ã€‚  
**â€»ä¸‹è¨˜ã¯ã‚ãã¾ã§ä¸€ä¾‹ã§ã‚ã‚Šã€èª¿ã¹ã¦ã¿ãŸçµæœä»–ã«ã‚‚ç¨®é¡ãŒã‚ã‚Šã¾ã—ãŸã€‚**  
**ãã®ä»–ã®ç¨®é¡ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**  
[Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:Secret](https://kubernetes.io/docs/concepts/configuration/secret/)

**data**:

- `data`: æ©Ÿå¯†æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿
- `data.message`: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿
- `data.keyfile`: ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿
  **â€»base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚**  
  base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ã€[base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰](https://qiita.com/kazukimatsumoto/items/13170a85242449140121)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**containers**:

- `spec.containers.env.valueForm`: å€¤ã®å–å¾—å…ƒã‚’æŒ‡å®š
- `spec.containers.env.valueFrom.secretKeyRef.name`: Secretã‹ã‚‰å€¤ã‚’å‚ç…§
- `spec.containers.env.valueFrom.secretKeyRef.key`: Secretã®ã‚­ãƒ¼ã‚’æŒ‡å®š
- `spec.containers.volumeMounts`: ãƒã‚¦ãƒ³ãƒˆå…ˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `spec.volumes`: ãƒã‚¦ãƒ³ãƒˆå…ˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `spec.volumes.secret.secretName`: Secretã®åå‰ã‚’æŒ‡å®š
- `spec.volumes.secret.items`: ãƒã‚¦ãƒ³ãƒˆå…ˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `spec.volumes.secret.items.key`: ãƒã‚¦ãƒ³ãƒˆå…ˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `spec.volumes.secret.items.path`: ãƒã‚¦ãƒ³ãƒˆå…ˆã®ãƒ‘ã‚¹ã‚’æŒ‡å®š

ãƒªã‚½ãƒ¼ã‚¹ç”Ÿæˆæ–¹æ³•ã¯ã€2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚

| åˆ©ç”¨æ–¹æ³•                     | ãƒã‚¤ãƒ³ãƒˆ                                                                    |
| ---------------------------- | --------------------------------------------------------------------------- |
| ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥ç”Ÿæˆ           | ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼ã¯è¤‡æ•°ã§æŒ‡å®š                                                    |
| ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç”Ÿæˆ | ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç”Ÿæˆã¯ `kubectl apply` / Base64æ–‡å­—åˆ—ã®å€¤å–å¾—ãŒå¿…è¦ |

**ã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥ç”Ÿæˆ**:

```bash:minikube
kubectl create secret generic NAME OPTION
```

ãƒ»å¼•æ•°  
`NAME`: ãƒªã‚½ãƒ¼ã‚¹å  
`OPTION`: ã‚ªãƒ—ã‚·ãƒ§ãƒ³

ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³  
`--from-literal`: ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®š  
`--from-file`: ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®š  
`--from-env-file`: ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®š

**ã‚³ãƒãƒ³ãƒ‰ã§Base64æ–‡å­—åˆ—ã®å€¤ã‚’å–å¾—**:

```bash:minikube
echo -n 'TEXT' | base64
```

ãƒ»å¼•æ•°
`TEXT`: Base64å¤‰æ›ã—ãŸã„æ–‡å­—åˆ—

ãƒªã‚½ãƒ¼ã‚¹åˆ©ç”¨æ–¹æ³•ã¯ã€2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚

| åˆ©ç”¨æ–¹æ³•               | ãƒã‚¤ãƒ³ãƒˆ                                                      |
| ---------------------- | ------------------------------------------------------------- |
| ç’°å¢ƒå¤‰æ•°ã¸æ¸¡ã™         | spec.containers.env.valueFrom ã« Secret ã‚’æŒ‡å®š                |
| ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒã‚¦ãƒ³ãƒˆ | spec.volumes ã¨ spec.containers.volumeMounts ã« Secret ã«æŒ‡å®š |

#### æ¼”ç¿’

```txt:ãŠé¡Œç›®
1.Secret ã¨ Pod ã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
3.Pod ã«å…¥ã£ã¦ Secret ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
```

1.ã¾ãšåˆã‚ã«ã€ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ Secret ã‚’ä½œæˆã—ã¾ã™ã€‚  
ã€Œãƒªãƒ†ãƒ©ãƒ«ã€ã¨ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€ã®2ç¨®é¡ã§ `tutorial` é…ä¸‹ã«Secret ã‚’ä½œæˆã—ã¾ã™:

```bash:keyfile
OUR-SECRET-KEY
```

```bash:minikube
root@minikube:~/tutorial# ls
keyfile  secret.yml
root@minikube:~/tutorial#
```

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:

```bash:minikube
kubectl create secret generic sample-secret \
--from-literal=message='Hello World!' \
--from-file=keyfile=./keyfile
```

ä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl get secret
NAME            TYPE     DATA   AGE
sample-secret   Opaque   2      44s
root@minikube:~/tutorial#
```

ä¸­èº«ã®ç¢ºèªã‚’YAMLå½¢å¼ã§ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl get secret/sample-secret -o yaml
apiVersion: v1
data:
  keyfile: T1VSLVNFQ1JFVC1LRVk=
  message: SGVsbG8gV29ybGQh
kind: Secret
metadata:
  creationTimestamp: "2025-06-01T09:18:44Z"
  name: sample-secret
  namespace: default
  resourceVersion: "50834"
  uid: 68d757b5-1623-4e58-ae03-81af0a8ec077
type: Opaque
root@minikube:~/tutorial#
```

`keyfile` ã¨ `message` ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚  
æ‰‹å‹•ã§ã®ç”Ÿæˆã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã®ã§ã€ä¸€æ—¦ä½œæˆã—ãŸã‚‚ã®ã‚’å‰Šé™¤ã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl delete secret/sample-secret
secret "sample-secret" deleted
root@minikube:~/tutorial# kubectl get secret
No resources found in default namespace.
root@minikube:~/tutorial#
```

2.Secret ã¨ Pod ã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ãŒã€Base64ã®æ–‡å­—åˆ—ã‚’å–å¾—ã—ãªã„ã¨ã„ã‘ãªã„ãŸã‚ã€ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# echo -n 'Hello World !' | base64
SGVsbG8gV29ybGQgIQ==
root@minikube:~/tutorial#
```

```bash:minikube
root@minikube:~/tutorial# echo -n 'OUR-SECRET-KEY' | base64
T1VSLVNFQ1JFVC1LRVk=
root@minikube:~/tutorial#
```

ãã‚Œãã‚Œå–å¾—ã§ãã¾ã—ãŸã®ã§ã€ã“ã‚Œã‚‰ã‚’åŸºã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:

::: details secret.yml

```yaml:secret.yml
apiVersion: v1
kind: Secret
metadata:
  name: sample-secret
data:
  message: SGVsbG8gV29ybGQgIQ==     # echo -n 'Hello World !' | base64
  keyfile: T1VSLVNFQ1JFVC1LRVk=     # cat ./keyfile | base64

---
apiVersion: v1
kind: Pod
metadata:
  name: sample
  namespace: default
spec:
  containers:
  - name: sample
    image: nginx:1.17.2-alpine
    env:
    - name: MESSAGE
      valueFrom:
        secretKeyRef:
          name: sample-secret
          key: message
    volumeMounts:
    - name: secret-storage
      mountPath: /home/nginx
  volumes:
  - name: secret-storage
    secret:
      secretName: sample-secret
      items:
      - key: keyfile
        path: keyfile
```

:::

3.Pod ã«å…¥ã£ã¦ Secret ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f secret.yml
secret/sample-secret created
pod/sample created
root@minikube:~/tutorial#
```

```bash:minikube
root@minikube:~/tutorial# kubectl get pod
NAME     READY   STATUS    RESTARTS   AGE
sample   1/1     Running   0          36s
root@minikube:~/tutorial# kubectl exec -it sample -- sh
/ # ls /home/nginx/
keyfile
/ # cat /home/nginx/keyfile
YOUR-SECRET-KEY/ #
/ #
```

`keyfile` ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚
æ¼”ç¿’ã¨ã—ã¦ã¯å®Œäº†ãªã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦Podã‚’å‰Šé™¤ã—ã¾ã™ã€‚

---

### æ°¸ç¶šãƒ‡ãƒ¼ã‚¿ (PersistentVolume, PersistentVolumeClaim)

#### PersistentVolume(PV) ã¨ã¯ï¼Ÿ

æ°¸ç¶šãƒ‡ãƒ¼ã‚¿ã®å®Ÿæ…‹ã®ã“ã¨ã€‚

- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æ¥ç¶šæƒ…å ±
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®æŠ½è±¡åŒ–

**â–¼ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè£…æ–¹æ³•**:

```yaml:pv.yml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-storage
  spec:
  # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æŠ½è±¡åŒ–ã‚’å®šç¾©ã™ã‚‹3ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ (storageClassName, accessModes, capacity)
  storageClassName: host
  accessModes: [ReadWriteOnce]
  capacity:
  storage: 1Gi
  # å‰Šé™¤å‹•ä½œã‚’å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ (persistentVolumeReclaimPolicy)
  persistentVolumeReclaimPolicy: Retain
  # ä¿å­˜å…ˆã‚’å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ (hostPath)
  hostPath:
  path: /data/storage
  type: Directory
```

**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æŠ½è±¡åŒ–ã‚’å®šç¾©ã™ã‚‹3ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**:

- `storageClassName`: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç¨®é¡ã‚’æŒ‡å®š
- `accessModes`: ã‚¢ã‚¯ã‚»ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’æŒ‡å®š
  - `ReadWriteOnce`: èª­ã¿æ›¸ãå¯èƒ½
  - `ReadOnlyMany`: èª­ã¿è¾¼ã¿ã®ã¿å¯èƒ½
  - `ReadWriteMany`: èª­ã¿æ›¸ãå¯èƒ½
- `capacity`: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å®¹é‡ã‚’æŒ‡å®š

**å‰Šé™¤å‹•ä½œã‚’å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**:

- `persistentVolumeReclaimPolicy`: å‰Šé™¤æ™‚ã®å‹•ä½œã‚’æŒ‡å®š
- `Retain`: å‰Šé™¤æ™‚ã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯å‰Šé™¤ã•ã‚Œãªã„
- `Delete`: å‰Šé™¤æ™‚ã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯å‰Šé™¤ã•ã‚Œã‚‹
- `Recycle`: (**Kubernetes v1.15ä»¥é™ã§éæ¨å¥¨**)å‰Šé™¤æ™‚ã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯å‰Šé™¤ã•ã‚Œã‚‹

**ä¿å­˜å…ˆã‚’å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**:

- `hostPath`: ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `path`: ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
- `type`: ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®ãƒ‘ã‚¹ã®ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®š
  - `DirectoryOrCreate`: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
  - `Directory`: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼
  - `FileOrCreate`: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
  - `File`: ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼

#### PersistentVolumeClaim(PVC) ã¨ã¯ï¼Ÿ

æ°¸ç¶šãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚ã™ã‚‹ã‚‚ã®ã€‚

**â–¼ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè£…æ–¹æ³•**:

```yaml:pvc.yml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-storage
  spec:
  # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æŠ½è±¡åŒ–ã‚’å®šç¾©ã™ã‚‹3ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ (storageClassName, accessModes, resources)
  storageClassName: host
  accessModes: [ReadWriteOnce]
  resources:
  requests:
  storage: 1Gi
```

PVã¨é•ã„ã€PVCã¯è¦æ±‚ã™ã‚‹å‹•ãã«ãªã£ã¦ã„ã‚‹ã®ã§ `requests` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

#### æ¼”ç¿’

```txt:ãŠé¡Œç›®
1.PVã¨PVCã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
2.ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆ
```

1.PVã¨PVCã‚’å«ã‚€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™:

::: details storage.yml

```yaml:storage.yml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: volume-01
  labels:
    env: study
spec:
  storageClassName: slow
  accessModes:
  - ReadWriteOnce
  capacity:
    storage: 1Gi
  persistentVolumeReclaimPolicy: Retain
  hostPath:
    path: "/data/storage"
    type: Directory

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: volume-claim
  labels:
    env: study
spec:
  storageClassName: slow
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi

```

:::

ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹å‰ã«ã€ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# mkdir -p /data/storage
root@minikube:~/tutorial#
root@minikube:~/tutorial# ls /data
storage
root@minikube:~/tutorial#
```

2.ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™:

```bash:minikube
root@minikube:~/tutorial# kubectl apply -f storage.yml
persistentvolume/volume-01 created
persistentvolumeclaim/volume-claim created
root@minikube:~/tutorial# kubectl get pvc,pv
NAME                                 STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/volume-claim   Bound    volume-01   1Gi        RWO            slow           <unset>                 57s

NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                  STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
persistentvolume/volume-01   1Gi        RWO            Retain           Bound    default/volume-claim   slow           <unset>                          57s
root@minikube:~/tutorial#
```

å‡ºåŠ›çµæœãŒè¦‹ã«ãã„ãŒã€ `volume-01` ã¨ã„ã†åå‰ã®PVãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚  
**PVå´ã«PVCãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹**ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚
æ¼”ç¿’ã¨ã—ã¦ã¯å®Œäº†ãªã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰æŠœã‘ã¦Podã‚’å‰Šé™¤ã—ã¾ã™ã€‚

---

### StatefulSet

---

### Ingress

## ğŸ‰ ã¾ã¨ã‚

é•·ã„æ™‚é–“ã”è¦§ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
ã“ã®è¨˜äº‹ã§ã¯ã€Kubernetesã®åŸºæœ¬æ¦‚å¿µã‹ã‚‰å®Ÿéš›ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã¾ã§ã‚’é€šã—ã¦å­¦ç¿’ã—ã¾ã—ãŸã€‚

**å­¦ç¿’ã—ãŸå†…å®¹**:

- Kubernetesã®åŸºæœ¬æ¦‚å¿µã¨Dockerã¨ã®é•ã„
- Kubernetesã®ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- minikubeã‚’ä½¿ã£ãŸç’°å¢ƒæ§‹ç¯‰
- åŸºæœ¬çš„ãªkubectlã‚³ãƒãƒ³ãƒ‰ã®ä½¿ã„æ–¹
- Podã®ä½œæˆãƒ»ç¢ºèªãƒ»å‰Šé™¤ã®å®Ÿè·µ

Kubernetesã¯å­¦ç¿’ã‚³ã‚¹ãƒˆãŒé«˜ã„ãƒ„ãƒ¼ãƒ«ã§ã™ãŒã€ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦éå¸¸ã«å¼·åŠ›ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚ä»Šå›ã®åŸºç¤å­¦ç¿’ã‚’åœŸå°ã«ã€ã•ã‚‰ã«æ·±ã„ç†è§£ã‚’ç›®æŒ‡ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

æ¬¡å›ã¯ã€ã‚ˆã‚Šå®Ÿè·µçš„ãªãƒªã‚½ãƒ¼ã‚¹ã«ã¤ã„ã¦å­¦ç¿’ã—ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã—ã¦ã„ãäºˆå®šã§ã™ã€‚
