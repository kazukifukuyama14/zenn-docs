---
title: "React × Rails アプリケーション（Docker コンテナ化）"
emoji: "🐳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Docker, docker-compose.yml, Tech]
published: true


---
## 📝 はじめに
https://zenn.dev/wan0ri/articles/ee3a7dff1b368e

Dockerの基本的なコマンドについて上記記事に触れてきたが、一からDockerイメージをPullして起動させるのは大変だし管理が煩雑になってしまう。
そこで、docker-composeを利用してDockerイメージのビルドを簡単にしていく手順を掲載する。

<br>

## 🎤 解説
### docker composeとは？
https://docs.docker.jp/compose/index.html
<公式の説明より引用>
> Compose とは、複数のコンテナを定義し実行する Docker アプリケーションのためのツールです。
> Compose は YAML ファイルを使い、アプリケーションのサービスを設定します。コマンドを１つ実行するだけで、設定内容に基づいた全てのサービスを生成・起動します。

「What？」という感じだが、噛み砕いて説明すると

**YAMLファイルに起動のための設定を記述することによって、複数のDockerコンテナをひとつのコマンドで立ち上げることができる**

という感じ。

### Dockerfileとdocker-composeの違い
以前にDockerfileについての記事を書いたが、
Dockerfileとdocker-composeそれぞれの違いについてまとめてみる。
https://zenn.dev/wan0ri/articles/dd7056371fac57


**▼Dockerfile**
【解説】
前段の復習になるが、Dockerfileとは
**自分の好きなようにカスタマイズしたDockerイメージを作成するためのファイル**
になる。
Dockerを使用する際に、

`docker container run`

コマンド実行後に

`docker exec -it [コンテナID] /bin/bash`

コマンドでコンテナにログインしたあとに、足りないモジュールのインストールやディレクトリ・ファイルの作成など、各種コマンドを実行することがあるかと思われる。
それをあらかじめDockerfileに記述することで、そのようなコマンドを起動時に自動で実行してくれるカスタマイズ版Dockerイメージを作成することができる。

【Dockerfileを用いたDockerイメージの作成の方法】
Dockerfileの配置されたディレクトリで

`docker build -t [イメージ名] . `

コマンドを実行すると、ローカル環境にDockerfileの内容を元にローカル環境にDockerイメージが作成される。

【メリット】
Dockerfileファイルを記述することで、

『Dockerイメージを」pullして、`docker container run`コマンドを実行後にそのコンテナにログインして、環境変数などのコマンドを実行して〜（省略）』

などの手順書が、

『Dockerfileがあるディレクトリで`docker build -t [イメージ名] .`コマンドを実行する。』

の1行で済むようになる。

**▼docker-compose**
【解説】
- **複数のコンテナで構成されるアプリケーションをDockerイメージのビルドや各コンテナの起動・停止などをより簡単に行えるようにするツール**。
- docker-composeでは、Dockerイメージの作成やコンテナ起動のオプションなどを含め、**複数のコンテナの定義をymlファイル（docker-compose.yml）に書き**、それを利用してDockerビルドやコンテナ起動をすることができる。

【Dockerfileを用いたDockerイメージの作成の方法】
docker-compose.yml の配置されたディレクトリで

`docker-compose up -d`

コマンドを実行するだけ。

ちなみにdocker-compose.ymlに書かれている内容で以下のような処理を実行する。

1. Dockerイメージを作成する（Dockerfileからイメージを作成することも可能）
2. そのDockerイメージを使って実行したいコマンドをymlファイル内に記述し実行する（環境変数の宣言、ポートやボリュームの設定など）

【メリット】
docker-compose.ymlファイルを記述することで、

『まず、このディレクトリで`docker build -t [イメージ名] .`コマンド実行後に、後続のコマンドを実行し、`docker container run [イメージA]`と`docker container run [イメージB]`の複数イメージをビルドして…』

などのDocker環境構築手順が

『docker-compose.ymlファイルがあるディレクトリで`docker compose up --build -d`コマンドを実行する。』

の1回で済むようになる。

## 🔥 実践
https://github.com/kazukifukuyama14/rails-react

### アプリケーションの概要
元々React × Rails アプリケーションでソースコードをアップされていた方のリソースを拝借し、Dockerfileとdocker-compose.ymlを作成した。

構成としては、以下観点でファイルを作成した。
- 拝借したソースコードはRails 7にReactが統合されている構成なので、一般的な「frontend（React単体）」＋「backend（APIサーバ）」という分離型ではなく、Rails内にReactが組み込まれているスタイル（モノリシックな構造）なので、Dockerfileはプロジェクトルート直下に作成している。
- docker-compose.ymlもプロジェクトルート直下に作成している。

### 苦労したこと
- フロントエンド・バックエンドの言語に精通していないので、Docker各ファイルを作成後に起動した際にエラーが大量に出てしまったので、Rails(Ruby)の依存関係などの解消に苦労した。
- 拝借したソースコードがどうやら未履修のGitHub Actionsが実行されるようなリソースだったらしく、PUSH後に大量にエラーが出てしまった。

（AIの力を借りてどうにか解消できた。AI様々🙏）
